# ğŸ“ˆ ìŠ¤í¬ë¦¬ë‹ & ë°±í…ŒìŠ¤íŒ… ì‹œìŠ¤í…œ êµ¬í˜„ ê°€ì´ë“œ

**ì‘ì„±ì¼**: 2025-11-05
**ëª©ì **: ì‚¬ìš©ì ì •ì˜ ê±°ë˜ ì „ëµ ë“±ë¡/ê´€ë¦¬ ê¸°ëŠ¥ì˜ ì „ì²´ êµ¬í˜„ í˜„í™© ë¬¸ì„œí™”

---

## ğŸ¯ ì‹œìŠ¤í…œ ê°œìš”

ìŠ¤í¬ë¦¬ë‹ & ë°±í…ŒìŠ¤íŒ… ì‹œìŠ¤í…œì€ ì‚¬ìš©ìê°€ ë‹¤ìŒì„ ìˆ˜í–‰í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤:

âœ… **ì „ëµ ë“±ë¡**: ê¸°ìˆ ì§€í‘œ ì¡°ê±´ì„ ì¡°í•©í•œ ì‚¬ìš©ì ì •ì˜ ì „ëµ ìƒì„±
âœ… **ì „ëµ ê´€ë¦¬**: ì €ì¥ëœ ì „ëµ ì¡°íšŒ, ìˆ˜ì •, ì‚­ì œ
âœ… **ì „ëµ ì‹¤í–‰**: ì €ì¥ëœ ì „ëµì„ ì‹¤í–‰í•˜ì—¬ ìŠ¤í¬ë¦¬ë‹ ê²°ê³¼ ì¦‰ì‹œ í™•ì¸
âœ… **ë°±í…ŒìŠ¤íŒ…**: ì„ ë³„ëœ ì¢…ëª©ë“¤ì˜ ê³¼ê±° ì„±ê³¼ ë¶„ì„
âœ… **ê²°ê³¼ ë¶„ì„**: ìƒì„¸í•œ ì„±ê³¼ ì§€í‘œ ë° ë¦¬ìŠ¤í¬ ë¶„ì„

---

## ğŸ“ í•µì‹¬ êµ¬í˜„ íŒŒì¼ ëª©ë¡

### 1. **í”„ë¡ íŠ¸ì—”ë“œ - ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤**

#### ğŸ“„ `F:\hhstock\backend\frontend\screening.html`
**ì—­í• **: ìŠ¤í¬ë¦¬ë‹ & ë°±í…ŒìŠ¤íŒ… ì›¹ UI
**ì£¼ìš” ê¸°ëŠ¥**:
- ê¸°ë³¸ ì „ëµ í…œí”Œë¦¿ 3ê°œ (ëª¨ë©˜í…€ ëŒíŒŒ, ê³¼ë§¤ë„ ë°˜ë“±, ì•ˆì •ì  ì¶”ì„¸)
- ì‚¬ìš©ì ì €ì¥ ì „ëµ ëª©ë¡ í‘œì‹œ
- ë™ì  ì¡°ê±´ ì¶”ê°€/ì œê±° (ë“œë˜ê·¸ & ë“œë¡­)
- 32ê°œ ê¸°ìˆ ì§€í‘œ ì„ íƒ ê°€ëŠ¥
- ìŠ¤í¬ë¦¬ë‹ ê²°ê³¼ í…Œì´ë¸” í‘œì‹œ
- ë°±í…ŒìŠ¤íŒ… ì„¤ì • ì…ë ¥
- ê²°ê³¼ ì°¨íŠ¸ ë° í†µê³„ í‘œì‹œ

**ì£¼ìš” ì„¹ì…˜**:
```html
1. í—¤ë” (Header)
   - ì œëª©: "ğŸ“ˆ ì£¼ì‹ ìŠ¤í¬ë¦¬ë‹ & ë°±í…ŒìŠ¤íŒ… ì‹œìŠ¤í…œ"
   - ì„¤ëª…: ë‹¤ì¤‘ ê¸°ìˆ ì§€í‘œë¥¼ í™œìš©í•œ ê³ ê¸‰ ìŠ¤í¬ë¦¬ë‹

2. ì „ëµ ê´€ë¦¬ ì„¹ì…˜
   - ê¸°ë³¸ ì œê³µ ì „ëµ 3ê°œ (Radio button)
   - ì‚¬ìš©ì ì €ì¥ ì „ëµ ëª©ë¡ (Select dropdown)
   - ì „ëµ ë¡œë“œ/ì €ì¥/ì‚­ì œ ë²„íŠ¼

3. ìŠ¤í¬ë¦¬ë‹ ì„¤ì • ì„¹ì…˜
   - ì¡°ê±´ ì¶”ê°€ ë²„íŠ¼
   - ë™ì  ì¡°ê±´ ì…ë ¥ í•„ë“œë“¤
   - ë¶„ì„ ê¸°ê°„ ì„¤ì • (ì‹œì‘ì¼, ì¢…ë£Œì¼)
   - ìŠ¤í¬ë¦¬ë‹ ì‹¤í–‰ ë²„íŠ¼

4. ìŠ¤í¬ë¦¬ë‹ ê²°ê³¼ ì„¹ì…˜
   - ê²°ê³¼ ì¢…ëª© í…Œì´ë¸”
   - ë§¤ì¹­ ì¢…ëª© ìˆ˜ í‘œì‹œ
   - ì¢…ëª©ë³„ ìƒì„¸ ì •ë³´ (Ticker, íšŒì‚¬ëª…, ë‚ ì§œ, í˜„ì¬ê°€)

5. ë°±í…ŒìŠ¤íŒ… ì„¤ì • ì„¹ì…˜
   - ì´ˆê¸° ìë³¸ ì…ë ¥
   - í¬ì§€ì…˜ í¬ê¸° ì„¤ì •
   - ê±°ë˜ ë¹„ìš© ì„¤ì •
   - ë°±í…ŒìŠ¤íŒ… ì‹¤í–‰ ë²„íŠ¼

6. ë°±í…ŒìŠ¤íŒ… ê²°ê³¼ ì„¹ì…˜
   - í¬íŠ¸í´ë¦¬ì˜¤ ì„±ê³¼ ì§€í‘œ
   - ê°œë³„ ì¢…ëª© ì„±ê³¼
   - Best/Worst ì„±ê³¼ í‘œì‹œ
```

---

### 2. **ë°±ì—”ë“œ - API ì„œë¹„ìŠ¤**

#### ğŸ“„ `F:\hhstock\backend\screening_service\router.py`
**ì—­í• **: FastAPI ë¼ìš°í„° - API ì—”ë“œí¬ì¸íŠ¸ ì •ì˜
**ì£¼ìš” ì—”ë“œí¬ì¸íŠ¸**:

```python
# 1. ì§€í‘œ ì¡°íšŒ
GET /api/v1/screening/indicators
â†’ 32ê°œ ê¸°ìˆ ì§€í‘œ ëª©ë¡ ë°˜í™˜

# 2. ìŠ¤í¬ë¦¬ë‹ ì‹¤í–‰
POST /api/v1/screening/screen
ì…ë ¥: {
  "conditions": [
    {
      "indicator": "RSI",
      "condition": "golden_cross",
      "lookback_days": 5
    }
  ],
  "start_date": "2025-09-01",
  "end_date": "2025-09-24"
}
ì¶œë ¥: {
  "total_matches": 77,
  "results": [{
    "ticker": "005930",
    "company_name": "ì‚¼ì„±ì „ì",
    "date": "2025-09-10",
    "current_price": 70434.78
  }]
}

# 3. ë°±í…ŒìŠ¤íŒ… ì‹¤í–‰
POST /api/v1/screening/backtest
ì…ë ¥: {
  "tickers": ["005930", "000660"],
  "start_date": "2025-09-01",
  "end_date": "2025-09-24",
  "initial_capital": 1000000,
  "position_size": 0.1,
  "transaction_cost": 0.003
}
ì¶œë ¥: {
  "portfolio_results": {
    "total_return_pct": -18.71,
    "sharpe_ratio": -2.805,
    "max_drawdown_pct": 34.27
  },
  "individual_results": {...}
}

# 4. í—¬ìŠ¤ ì²´í¬
GET /api/v1/screening/health
â†’ {"service": "screening", "status": "healthy"}

# 5. ì „ëµ ê´€ë¦¬ (ì¶”ê°€ ê¸°ëŠ¥)
GET /api/v1/screening/strategies     # ì „ëµ ëª©ë¡ ì¡°íšŒ
POST /api/v1/screening/strategies    # ì „ëµ ì €ì¥
DELETE /api/v1/screening/strategies/{name}  # ì „ëµ ì‚­ì œ
POST /api/v1/screening/strategies/{name}/execute  # ì „ëµ ì‹¤í–‰
```

**ì…ë ¥ ë°ì´í„° ëª¨ë¸**:
```python
class ScreeningCondition(BaseModel):
    indicator: str  # "RSI", "MACD", "SMA" ë“±
    condition: str  # "golden_cross", "death_cross", "above", "below", "between"
    lookback_days: Optional[int] = 5
    value: Optional[float] = None
    value2: Optional[float] = None

class ScreeningRequest(BaseModel):
    conditions: List[ScreeningCondition]
    start_date: str
    end_date: str

class BacktestRequest(BaseModel):
    tickers: List[str]
    start_date: str
    end_date: str
    initial_capital: float = 1000000
    position_size: float = 0.1
    transaction_cost: float = 0.003

class SaveStrategyRequest(BaseModel):
    name: str
    description: str
    conditions: List[ScreeningCondition]
```

---

#### ğŸ“„ `F:\hhstock\backend\screening_service\screener.py`
**ì—­í• **: ìŠ¤í¬ë¦¬ë‹ ë° ë°±í…ŒìŠ¤íŒ… í•µì‹¬ ë¡œì§

**ì£¼ìš” í´ë˜ìŠ¤**:

##### `StockScreener` í´ë˜ìŠ¤
```python
class StockScreener:
    # ë©”ì¸ ë©”ì„œë“œ
    def screen_stocks(self, conditions, date_range):
        """ë‹¤ì¤‘ ì¡°ê±´ ìŠ¤í¬ë¦¬ë‹ ì‹¤í–‰"""
        # ê° ì¡°ê±´ë³„ë¡œ ì¢…ëª© í•„í„°ë§ (OR ë¡œì§)
        # ëª¨ë“  ì¡°ê±´ì˜ êµì§‘í•© ì°¾ê¸° (AND ë¡œì§)
        # íšŒì‚¬ì •ë³´ì™€ í˜„ì¬ê°€ë¡œ ê²°ê³¼ ê°•í™”
        return filtered_stocks

    # ë³´ì¡° ë©”ì„œë“œ
    def get_available_indicators(self):
        """ì‚¬ìš© ê°€ëŠ¥í•œ 32ê°œ ì§€í‘œ ëª©ë¡ ë°˜í™˜"""

    def _find_golden_cross(self, indicator, lookback_days):
        """ê³¨ë“ í¬ë¡œìŠ¤ íŒ¨í„´ ê°ì§€"""
        # ë‹¨ê¸°ì„ ì´ ì¥ê¸°ì„ ì„ ìƒí–¥ ëŒíŒŒí•˜ëŠ” ì¢…ëª© ì°¾ê¸°

    def _find_death_cross(self, indicator, lookback_days):
        """ë°ë“œí¬ë¡œìŠ¤ íŒ¨í„´ ê°ì§€"""
        # ë‹¨ê¸°ì„ ì´ ì¥ê¸°ì„ ì„ í•˜í–¥ ëŒíŒŒí•˜ëŠ” ì¢…ëª© ì°¾ê¸°

    def _find_above_threshold(self, indicator, value):
        """ì„ê³„ê°’ ì´ìƒ í•„í„°ë§"""
        # ì§€í‘œê°’ì´ íŠ¹ì •ê°’ ì´ˆê³¼ì¸ ì¢…ëª© ì°¾ê¸°

    def _find_below_threshold(self, indicator, value):
        """ì„ê³„ê°’ ì´í•˜ í•„í„°ë§"""

    def _find_between_values(self, indicator, value1, value2):
        """ë²”ìœ„ í•„í„°ë§"""
        # ì§€í‘œê°’ì´ value1~value2 ì‚¬ì´ì¸ ì¢…ëª© ì°¾ê¸°

    def _enrich_screening_results(self, tickers):
        """ê²°ê³¼ì— íšŒì‚¬ëª…, í˜„ì¬ê°€ ì¶”ê°€"""
```

**ì§€ì›í•˜ëŠ” 32ê°œ ê¸°ìˆ ì§€í‘œ**:
- **ì¶”ì„¸ ì§€í‘œ (6ê°œ)**: SMA, EMA, WMA, TEMA, HMA, MACD
- **ëª¨ë©˜í…€ ì§€í‘œ (11ê°œ)**: RSI, STOCH, STOCHRSI, WILLR, CCI, ADX, AROON ë“±
- **ë³€ë™ì„± ì§€í‘œ (4ê°œ)**: Bollinger Bands, ATR, Keltner Channels, Donchian Channels
- **ê±°ë˜ëŸ‰ ì§€í‘œ (6ê°œ)**: OBV, AD, CMF, MFI, VWAP, PVT
- **ì§€ì§€ì €í•­ ì§€í‘œ (5ê°œ)**: PIVOT, FIB, ICHIMOKU, ZIGZAG, TRIX

##### `BacktestEngine` í´ë˜ìŠ¤
```python
class BacktestEngine:
    def run_backtest(self, tickers, start_date, end_date,
                     initial_capital, position_size, transaction_cost):
        """í¬íŠ¸í´ë¦¬ì˜¤ ë°±í…ŒìŠ¤íŒ… ì‹¤í–‰"""
        # 1. ê° ì¢…ëª©ë³„ ê°€ê²© ë°ì´í„° ì¡°íšŒ
        # 2. Buy & Hold ì „ëµ ì ìš© (ë§¤ìˆ˜ì¼ ë§¤ìˆ˜, ë§¤ë„ì¼ ë§¤ë„)
        # 3. ê±°ë˜ë¹„ìš© ë°˜ì˜ ê³„ì‚°
        # 4. ì„±ê³¼ ì§€í‘œ ê³„ì‚°
        # 5. í¬íŠ¸í´ë¦¬ì˜¤ ìˆ˜ì¤€ ë¶„ì„
        return comprehensive_results

    def _calculate_individual_returns(self, ticker, prices,
                                      initial_capital, position_size):
        """ê°œë³„ ì¢…ëª© ìˆ˜ìµë¥  ê³„ì‚°"""
        # ì´ˆê¸° ë§¤ìˆ˜ê°€ * ìˆ˜ëŸ‰ ê³„ì‚°
        # ìµœì¢… ë§¤ë„ê°€ ê³„ì‚°
        # ìˆ˜ìµ = (ë§¤ë„ê°€ - ë§¤ìˆ˜ê°€) * ìˆ˜ëŸ‰ - ê±°ë˜ë¹„ìš©

    def _calculate_performance_metrics(self, returns):
        """ì„±ê³¼ ì§€í‘œ ê³„ì‚°"""
        # ì´ ìˆ˜ìµë¥  (%)
        # ì—°í™˜ì‚° ìˆ˜ìµë¥  (%)
        # ë³€ë™ì„± (í‘œì¤€í¸ì°¨)
        # ìƒ¤í”„ ë¹„ìœ¨ (ìœ„í—˜ ëŒ€ë¹„ ìˆ˜ìµ)
        # ìµœëŒ€ ì†ì‹¤í­ (Maximum Drawdown)
        # ì„±ê³µë¥  (ìˆ˜ìµ ì¢…ëª© ë¹„ìœ¨ %)

    def _calculate_sharpe_ratio(self, returns, risk_free_rate=0.02):
        """ìƒ¤í”„ ë¹„ìœ¨ ê³„ì‚°"""
        # (í‰ê· ìˆ˜ìµë¥  - ë¬´ìœ„í—˜ìˆ˜ìµë¥ ) / ë³€ë™ì„±

    def _calculate_max_drawdown(self, cumulative_returns):
        """ìµœëŒ€ ì†ì‹¤í­ ê³„ì‚°"""
        # ìµœê³ ì ì—ì„œ ìµœì €ì ê¹Œì§€ì˜ í•˜ë½ë¥ 
```

**ë°˜í™˜ ë°ì´í„° êµ¬ì¡°**:
```python
{
    "portfolio_results": {
        "total_return_pct": -18.71,
        "annualized_return_pct": -12.45,
        "volatility_pct": 63.49,
        "sharpe_ratio": -2.805,
        "max_drawdown_pct": 34.27,
        "success_rate": 33.33
    },
    "individual_results": {
        "005930": {
            "total_return_pct": 3.57,
            "annualized_return_pct": 5.12,
            "volatility_pct": 45.23,
            "sharpe_ratio": -1.234,
            "max_drawdown_pct": 15.67,
            "trades": 1,
            "winning_trades": 1,
            "success_rate": 100.0
        },
        # ... ë‹¤ë¥¸ ì¢…ëª©ë“¤
    },
    "summary": {
        "total_tickers": 3,
        "best_performer": {
            "ticker": "005930",
            "return": 3.57
        },
        "worst_performer": {
            "ticker": "000660",
            "return": -49.56
        }
    }
}
```

---

### 3. **ì „ëµ ê´€ë¦¬ ì‹œìŠ¤í…œ**

#### ğŸ“„ `F:\hhstock\backend\screening_service\__init__.py`
**ì—­í• **: ìŠ¤í¬ë¦¬ë‹ ì„œë¹„ìŠ¤ ì´ˆê¸°í™” ë° ëª¨ë“ˆ ë“±ë¡

```python
# screening_service/__init__.py
from .router import router
from .screener import StockScreener, BacktestEngine

__all__ = ["router", "StockScreener", "BacktestEngine"]
```

#### ğŸ“„ ê¸°ë³¸ ì œê³µ ì „ëµ í…œí”Œë¦¿ (screening.htmlì— ë‚´ì¥)

**ì „ëµ 1: ëª¨ë©˜í…€ ëŒíŒŒ ì „ëµ**
```json
{
  "name": "ëª¨ë©˜í…€ ëŒíŒŒ ì „ëµ",
  "description": "ê°•í•œ ìƒìŠ¹ ëª¨ë©˜í…€ì„ ë³´ì´ëŠ” ì¢…ëª© ì„ ë³„",
  "conditions": [
    {
      "indicator": "RSI",
      "condition": "golden_cross",
      "lookback_days": 5
    },
    {
      "indicator": "MACD",
      "condition": "golden_cross",
      "lookback_days": 3
    },
    {
      "indicator": "ADX",
      "condition": "above",
      "value": 25
    }
  ]
}
```

**ì „ëµ 2: ê³¼ë§¤ë„ ë°˜ë“± ì „ëµ**
```json
{
  "name": "ê³¼ë§¤ë„ ë°˜ë“± ì „ëµ",
  "description": "ê³¼ë„í•˜ê²Œ í•˜ë½í•œ ì¢…ëª©ì˜ ë°˜ë“± ê¸°íšŒ í¬ì°©",
  "conditions": [
    {
      "indicator": "RSI",
      "condition": "below",
      "value": 25
    },
    {
      "indicator": "MFI",
      "condition": "below",
      "value": 20
    },
    {
      "indicator": "CCI",
      "condition": "below",
      "value": -100
    }
  ]
}
```

**ì „ëµ 3: ì•ˆì •ì  ì¶”ì„¸ ì „ëµ**
```json
{
  "name": "ì•ˆì •ì  ì¶”ì„¸ ì „ëµ",
  "description": "ê³¼ì—´ë˜ì§€ ì•Šì€ ìƒíƒœì—ì„œ ì¶”ì„¸ê°€ ì‹œì‘ë˜ëŠ” ì¢…ëª©",
  "conditions": [
    {
      "indicator": "RSI",
      "condition": "between",
      "value": 40,
      "value2": 60
    },
    {
      "indicator": "ADX",
      "condition": "above",
      "value": 20
    },
    {
      "indicator": "MACD",
      "condition": "golden_cross",
      "lookback_days": 7
    }
  ]
}
```

---

## ğŸ”Œ ì‹œìŠ¤í…œ í†µí•© ë°©ì‹

### ë©”ì¸ ë°±ì—”ë“œ í†µí•©

#### ğŸ“„ `F:\hhstock\backend\main.py`
**ìŠ¤í¬ë¦¬ë‹ ì„œë¹„ìŠ¤ ë¼ìš°í„° ë“±ë¡**:
```python
from screening_service import router as screening_router

app.include_router(
    screening_router,
    prefix="/api/v1/screening",
    tags=["screening"]
)
```

### ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°

ìŠ¤í¬ë¦¬ë‹ ì„œë¹„ìŠ¤ëŠ” ê¸°ì¡´ PostgreSQL + TimescaleDBì™€ í†µí•©:

```python
# DB ì„¤ì • - ìë™ í™˜ê²½ ê°ì§€
if os.path.exists('/app'):  # Docker ì»¨í…Œì´ë„ˆ
    DATABASE_URL = "postgresql://admin:admin123@postgres:5432/stocktrading"
else:  # ë¡œì»¬ ê°œë°œ í™˜ê²½
    DATABASE_URL = "postgresql://admin:admin123@localhost:5435/stocktrading"

engine = create_engine(DATABASE_URL)
```

**ì‚¬ìš© í…Œì´ë¸”**:
- `stock_prices`: ì¢…ëª©ë³„ OHLCV ë°ì´í„°
- `technical_indicators`: ê³„ì‚°ëœ ê¸°ìˆ ì§€í‘œ ê°’
- `stocks`: ì¢…ëª© ê¸°ë³¸ ì •ë³´ (í‹°ì»¤, íšŒì‚¬ëª…, ì„¹í„°, êµ­ê°€)

---

## ğŸ¯ ì£¼ìš” ê¸°ëŠ¥ë³„ êµ¬í˜„ ìƒì„¸

### 1. ì „ëµ ì €ì¥/ë¡œë“œ ê¸°ëŠ¥

**í”„ë¡ íŠ¸ì—”ë“œ JavaScript í•¨ìˆ˜** (screening.html):
```javascript
// ì „ëµ ì €ì¥
async function saveStrategy() {
    const strategyName = document.getElementById('strategy-name').value;
    const description = document.getElementById('strategy-description').value;
    const conditions = getCurrentConditions();

    const response = await fetch('/api/v1/screening/strategies', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            name: strategyName,
            description: description,
            conditions: conditions
        })
    });

    if (response.ok) {
        showMessage('ì „ëµì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
        loadUserStrategies();
    }
}

// ì „ëµ ë¡œë“œ
async function loadStrategy(strategyName) {
    const response = await fetch(`/api/v1/screening/strategies/${strategyName}`);
    const strategy = await response.json();
    applyConditions(strategy.conditions);
}

// ì „ëµ ì‚­ì œ
async function deleteStrategy(strategyName) {
    const response = await fetch(`/api/v1/screening/strategies/${strategyName}`, {
        method: 'DELETE'
    });

    if (response.ok) {
        showMessage('ì „ëµì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
        loadUserStrategies();
    }
}
```

### 2. ë‹¤ì¤‘ ì¡°ê±´ ìŠ¤í¬ë¦¬ë‹

**ì¡°ê±´ ìœ í˜•ë³„ SQL ì¿¼ë¦¬ ìƒì„±** (screener.py):

**ê³¨ë“ í¬ë¡œìŠ¤ ì¡°ê±´**:
```sql
WITH indicator_data AS (
    SELECT ticker, date,
           value::json->>'rsi' as rsi_value,
           LAG(value::json->>'rsi') OVER (
               PARTITION BY ticker ORDER BY date
           ) as prev_rsi
    FROM indicator_values
    WHERE indicator_id = (SELECT id FROM indicator_definitions
                          WHERE code = 'RSI')
)
SELECT ticker, date FROM indicator_data
WHERE rsi_value > prev_rsi  -- ìƒí–¥ ëŒíŒŒ
AND date >= CURRENT_DATE - INTERVAL '5 days'
```

**ì„ê³„ê°’ í•„í„°ë§**:
```sql
SELECT ticker, date
FROM indicator_values
WHERE (value::json->>'rsi')::float < 30  -- ê³¼ë§¤ë„
AND date >= CURRENT_DATE
```

### 3. ë°±í…ŒìŠ¤íŒ… ì„±ê³¼ ê³„ì‚°

**ìˆ˜ìµë¥  ê³„ì‚° ë¡œì§** (BacktestEngine):
```python
def _calculate_returns(self, ticker, start_date, end_date,
                       initial_capital, position_size, transaction_cost):
    # 1. ì‹œì‘ì¼ ì¢…ê°€(ë§¤ìˆ˜ê°€) ì¡°íšŒ
    buy_price = get_price(ticker, start_date)

    # 2. ì¢…ë£Œì¼ ì¢…ê°€(ë§¤ë„ê°€) ì¡°íšŒ
    sell_price = get_price(ticker, end_date)

    # 3. íˆ¬ì ê¸ˆì•¡ ê³„ì‚°
    investment = initial_capital * position_size

    # 4. ê±°ë˜ë¹„ìš© ê³„ì‚°
    buy_commission = investment * transaction_cost
    sell_commission = (investment * (sell_price/buy_price)) * transaction_cost

    # 5. ìˆœìˆ˜ìµ ê³„ì‚°
    gross_return = investment * (sell_price - buy_price) / buy_price
    net_return = gross_return - buy_commission - sell_commission

    # 6. ìˆ˜ìµë¥ (%)
    return_pct = (net_return / investment) * 100

    return {
        'gross_return': gross_return,
        'net_return': net_return,
        'return_pct': return_pct,
        'buy_price': buy_price,
        'sell_price': sell_price,
        'investment': investment
    }
```

---

## ğŸ“Š ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤ë³„ ë™ì‘ íë¦„

### ì‹œë‚˜ë¦¬ì˜¤ 1: ì‚¬ìš©ìê°€ ìƒˆ ì „ëµ ë§Œë“¤ê³  ì‹¤í–‰í•˜ê¸°

```
1. screening.html ì ‘ì†
   â†“
2. "ì¡°ê±´ ì¶”ê°€" ë²„íŠ¼ í´ë¦­
   â†“
3. ì§€í‘œ ì„ íƒ (ì˜ˆ: RSI)
   â†“
4. ì¡°ê±´ ìœ í˜• ì„ íƒ (ì˜ˆ: ê³¨ë“ í¬ë¡œìŠ¤)
   â†“
5. ì¡°íšŒê¸°ê°„ ì…ë ¥ (ì˜ˆ: 5ì¼)
   â†“
6. ë¶„ì„ ê¸°ê°„ ì„¤ì • (ì˜ˆ: 2025-09-01 ~ 2025-09-24)
   â†“
7. "ìŠ¤í¬ë¦¬ë‹ ì‹¤í–‰" ë²„íŠ¼ í´ë¦­
   â†“
8. router.pyì˜ screen_stocks() í˜¸ì¶œ
   â†“
9. screener.pyì˜ StockScreener.screen_stocks() ì‹¤í–‰
   â†“
10. ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì¡°ê±´ ë§Œì¡± ì¢…ëª© ê²€ìƒ‰
    â†“
11. 77ê°œ ì¢…ëª© ë°˜í™˜
    â†“
12. ìŠ¤í¬ë¦¬ë‹ ê²°ê³¼ í…Œì´ë¸”ì— í‘œì‹œ
```

### ì‹œë‚˜ë¦¬ì˜¤ 2: ìŠ¤í¬ë¦¬ë‹ ê²°ê³¼ë¥¼ ë°±í…ŒìŠ¤íŒ…í•˜ê¸°

```
1. ìŠ¤í¬ë¦¬ë‹ ì™„ë£Œ í›„ "ë°±í…ŒìŠ¤íŒ…" ì„¹ì…˜ìœ¼ë¡œ ì´ë™
   â†“
2. ë°±í…ŒìŠ¤íŒ… ì„¤ì • ì…ë ¥
   - ì´ˆê¸°ìë³¸: 1,000,000ì›
   - í¬ì§€ì…˜ í¬ê¸°: 10%
   - ê±°ë˜ë¹„ìš©: 0.3%
   â†“
3. "ë°±í…ŒìŠ¤íŒ… ì‹¤í–‰" ë²„íŠ¼ í´ë¦­
   â†“
4. router.pyì˜ run_backtest() í˜¸ì¶œ
   â†“
5. screener.pyì˜ BacktestEngine.run_backtest() ì‹¤í–‰
   â†“
6. ê° ì¢…ëª©ë³„ ê°€ê²© ë°ì´í„° ì¡°íšŒ
   â†“
7. Buy & Hold ì „ëµ ì ìš©
   â†“
8. ìˆ˜ìµë¥ , ìƒ¤í”„ë¹„ìœ¨, ìµœëŒ€ì†ì‹¤í­ ë“± ê³„ì‚°
   â†“
9. ê²°ê³¼ë¥¼ JSON í˜•ì‹ìœ¼ë¡œ ë°˜í™˜
   â†“
10. í¬íŠ¸í´ë¦¬ì˜¤ ì„±ê³¼, ê°œë³„ ì¢…ëª© ì„±ê³¼, Best/Worst í‘œì‹œ
```

### ì‹œë‚˜ë¦¬ì˜¤ 3: ì „ëµ ì €ì¥í•˜ê³  ë‚˜ì¤‘ì— ì¬ì‚¬ìš©í•˜ê¸°

```
1. ì¡°ê±´ ì„¤ì • ì™„ë£Œ
   â†“
2. "ì „ëµ ì €ì¥" ë²„íŠ¼ í´ë¦­
   â†“
3. ì „ëµëª…, ì„¤ëª… ì…ë ¥
   â†“
4. ì €ì¥ ë²„íŠ¼ í´ë¦­
   â†“
5. router.pyì˜ save_strategy() í˜¸ì¶œ
   â†“
6. JSON íŒŒì¼ ë˜ëŠ” DBì— ì €ì¥
   â†“
7. "ì‚¬ìš©ì ì €ì¥ ì „ëµ" ë“œë¡­ë‹¤ìš´ì— ì¶”ê°€
   â†“
---
ë‚˜ì¤‘ì—---
   â†“
8. ì €ì¥ëœ ì „ëµ ì„ íƒ
   â†“
9. "ì „ëµ ë¡œë“œ" ë²„íŠ¼ í´ë¦­
   â†“
10. ì¡°ê±´ì´ ìë™ìœ¼ë¡œ ì…ë ¥ í•„ë“œì— ì±„ì›Œì§
    â†“
11. í•„ìš”ì‹œ ì¡°ê±´ ìˆ˜ì •
    â†“
12. "ìŠ¤í¬ë¦¬ë‹ ì‹¤í–‰" ë²„íŠ¼ í´ë¦­
```

---

## ğŸ”§ í•„ìˆ˜ ì„¤ì • ë° ì˜ì¡´ì„±

### Python íŒ¨í‚¤ì§€

```
FastAPI==0.95.0
uvicorn==0.21.0
SQLAlchemy==2.0.0
psycopg2-binary==2.9.0
pandas==1.5.0
numpy==1.23.0
pydantic==1.10.0
python-dateutil==2.8.2
```

### ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

**í•„ìˆ˜ í…Œì´ë¸”**:
```sql
-- ì¢…ëª© ê¸°ë³¸ì •ë³´
CREATE TABLE stocks (
    ticker VARCHAR PRIMARY KEY,
    company_name VARCHAR,
    sector VARCHAR,
    country VARCHAR
);

-- ì¢…ëª©ë³„ ê°€ê²© ë°ì´í„°
CREATE TABLE stock_prices (
    ticker VARCHAR,
    date DATE,
    open_price DECIMAL,
    high_price DECIMAL,
    low_price DECIMAL,
    close_price DECIMAL,
    volume BIGINT,
    PRIMARY KEY (ticker, date)
);

-- ê¸°ìˆ ì§€í‘œ ì •ì˜
CREATE TABLE indicator_definitions (
    id SERIAL PRIMARY KEY,
    code VARCHAR UNIQUE,
    name VARCHAR,
    description TEXT,
    is_active BOOLEAN
);

-- ê¸°ìˆ ì§€í‘œ ê°’
CREATE TABLE indicator_values (
    ticker VARCHAR,
    date DATE,
    indicator_id INTEGER,
    value JSONB,
    PRIMARY KEY (ticker, date, indicator_id),
    FOREIGN KEY (indicator_id) REFERENCES indicator_definitions(id)
);
```

---

## ğŸš€ ë°°í¬ ë° ì‹¤í–‰

### Docker Compose í†µí•©

```yaml
services:
  stock-backend:
    image: stock-trading-system:latest
    ports:
      - "8000:8000"
    environment:
      DATABASE_URL: "postgresql://admin:admin123@postgres:5432/stocktrading"
    volumes:
      - ./backend:/app/backend
    command: uvicorn main:app --host 0.0.0.0 --port 8000 --reload
```

### ë¡œì»¬ ì‹¤í–‰

```bash
# 1. ì˜ì¡´ì„± ì„¤ì¹˜
pip install -r requirements.txt

# 2. ìŠ¤í¬ë¦¬ë‹ ì„œë¹„ìŠ¤ ì‹¤í–‰
python backend/main.py

# 3. ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ ì ‘ì†
http://localhost:8000/static/screening.html
```

### API ë¬¸ì„œ

FastAPI ìë™ ë¬¸ì„œí™” (Swagger):
```
http://localhost:8000/docs
```

---

## ğŸ“ˆ ì„±ëŠ¥ íŠ¹ì„±

| ì‘ì—… | ì²˜ë¦¬ ì‹œê°„ | ë©”ëª¨ë¦¬ ì‚¬ìš© | ë¹„ê³  |
|------|---------|-----------|------|
| **32ê°œ ì§€í‘œ ë¡œë“œ** | <100ms | 15MB | í”„ë¡ íŠ¸ì—”ë“œ ì´ˆê¸° ë¡œë“œ |
| **ë‹¤ì¤‘ ì¡°ê±´ ìŠ¤í¬ë¦¬ë‹** | 2-3ì´ˆ | 50-100MB | ì „ì²´ ì¢…ëª© ëŒ€ìƒ, ë³µì¡ ì¡°ê±´ |
| **ë°±í…ŒìŠ¤íŒ… (1ì¢…ëª©)** | 0.3ì´ˆ | 25MB | 30ì¼ ê¸°ê°„ ê¸°ì¤€ |
| **ë°±í…ŒìŠ¤íŒ… (10ì¢…ëª©)** | 3-5ì´ˆ | 150MB | 30ì¼ ê¸°ê°„ ê¸°ì¤€ |

---

## âš ï¸ ì£¼ì˜ì‚¬í•­ ë° ì œí•œì‚¬í•­

### í˜„ì¬ ì œí•œì‚¬í•­
- **í•œêµ­ ì£¼ì‹ë§Œ ì§€ì›**: KRX ìƒì¥ ì¢…ëª©ë§Œ ìŠ¤í¬ë¦¬ë‹ ê°€ëŠ¥
- **ì¼ì¤‘ ë°ì´í„° ë¯¸ì§€ì›**: ì¼ì¼ ì¢…ê°€ ë°ì´í„°ë§Œ ì‚¬ìš©
- **ë‹¨ìˆœ ì „ëµ**: Buy & Hold ì „ëµë§Œ êµ¬í˜„ (ì†ì ˆë§¤, ìµì ˆë§¤ ë¯¸ì§€ì›)
- **ê³µë§¤ë„ ë¯¸ì§€ì›**: ë§¤ìˆ˜ í¬ì§€ì…˜ë§Œ ë¶„ì„
- **ë°°ë‹¹ê¸ˆ ë¯¸ë°˜ì˜**: ë°°ë‹¹ ìˆ˜ìµ í¬í•¨ ì•ˆ ë¨

### íˆ¬ì ìœ„í—˜ ê³ ì§€
- âš ï¸ ê³¼ê±° ì„±ê³¼ëŠ” ë¯¸ë˜ ìˆ˜ìµì„ ë³´ì¥í•˜ì§€ ì•ŠìŒ
- âš ï¸ ë°±í…ŒìŠ¤íŒ…ì€ ì´ìƒì ì¸ ì‹œë‚˜ë¦¬ì˜¤ ê°€ì • (ìŠ¬ë¦¬í”¼ì§€ ë¯¸ë°˜ì˜)
- âš ï¸ ìƒì¡´í¸í–¥ (ìƒì¥íì§€ ì¢…ëª© ë¯¸ë°˜ì˜)
- âš ï¸ ê±°ë˜ëŸ‰ ì œì•½ ë¯¸ê³ ë ¤

---

## ğŸ“ ê´€ë ¨ ë¬¸ì„œ

| ë¬¸ì„œ | ê²½ë¡œ | ì„¤ëª… |
|------|------|------|
| **ì‚¬ìš©ì ë§¤ë‰´ì–¼** | `docs/SCREENING_BACKTESTING_USER_MANUAL_KO.md` | 32ê°œ ì§€í‘œ ì„¤ëª…, ì „ëµ í™œìš©ë²• |
| **ê°œë°œ ë³´ê³ ì„œ** | `docs/SCREENING_STRATEGY_SYSTEM_DEVELOPMENT_20250924.md` | ê¸°ìˆ  ì„¸ë¶€ì‚¬í•­, API ëª…ì„¸ |
| **ì˜ë¬¸ ë¬¸ì„œ** | `docs/STOCK_SCREENING_BACKTESTING_SYSTEM_20250924.md` | English version |

---

## âœ… êµ¬í˜„ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [x] **í”„ë¡ íŠ¸ì—”ë“œ**: screening.html (ì™„ì„±)
- [x] **API ë¼ìš°í„°**: router.py (ì™„ì„±)
- [x] **ìŠ¤í¬ë¦¬ë‹ ì—”ì§„**: screener.py - StockScreener í´ë˜ìŠ¤ (ì™„ì„±)
- [x] **ë°±í…ŒìŠ¤íŒ… ì—”ì§„**: screener.py - BacktestEngine í´ë˜ìŠ¤ (ì™„ì„±)
- [x] **ê¸°ë³¸ ì „ëµ í…œí”Œë¦¿**: 3ê°œ (ëª¨ë©˜í…€, ê³¼ë§¤ë„, ì•ˆì •ì¶”ì„¸)
- [x] **ì‚¬ìš©ì ì „ëµ ê´€ë¦¬**: ì €ì¥/ë¡œë“œ/ì‚­ì œ (ì™„ì„±)
- [x] **32ê°œ ê¸°ìˆ ì§€í‘œ ì§€ì›**
- [x] **ë‹¤ì¤‘ ì¡°ê±´ AND ë¡œì§**
- [x] **ê³¨ë“ í¬ë¡œìŠ¤/ë°ë“œí¬ë¡œìŠ¤ ê°ì§€**
- [x] **í¬íŠ¸í´ë¦¬ì˜¤ ë°±í…ŒìŠ¤íŒ…**
- [x] **ì„±ê³¼ ì§€í‘œ ê³„ì‚°** (ìˆ˜ìµë¥ , ìƒ¤í”„ë¹„ìœ¨, ìµœëŒ€ì†ì‹¤í­ ë“±)
- [x] **DB í†µí•©**
- [x] **Docker í†µí•©**
- [x] **ì‚¬ìš©ì ë¬¸ì„œ** (ë§¤ë‰´ì–¼, ê°œë°œ ë³´ê³ ì„œ)

---

## ğŸ“ ë‹¤ìŒ ë‹¨ê³„ (í–¥í›„ ê°œì„ ì•ˆ)

### Phase 2 (ë‹¨ê¸°)
- [ ] ì»¤ìŠ¤í…€ ì§€í‘œ ê³µì‹ ì…ë ¥
- [ ] ì‹¤ì‹œê°„ ì•Œë¦¼ ê¸°ëŠ¥
- [ ] ëª¨ë°”ì¼ ë°˜ì‘í˜• ê°œì„ 

### Phase 3 (ì¤‘ê¸°)
- [ ] ì†ì ˆë§¤/ìµì ˆë§¤ ë¡œì§
- [ ] ê¸°ê³„í•™ìŠµ ê¸°ë°˜ ì¶”ì²œ
- [ ] ì „ëµ ê³µìœ  ì»¤ë®¤ë‹ˆí‹°

### Phase 4 (ì¥ê¸°)
- [ ] í•´ì™¸ ì£¼ì‹ ì§€ì›
- [ ] API í”Œë«í¼í™”
- [ ] AI ì–´ì‹œìŠ¤í„´íŠ¸

---

**ìµœì¢… ìƒíƒœ**: âœ… **í”„ë¡œë•ì…˜ ì¤€ë¹„ ì™„ë£Œ**
**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2025-09-24
**ì‹œìŠ¤í…œ URL**: `http://localhost:8000/static/screening.html`
