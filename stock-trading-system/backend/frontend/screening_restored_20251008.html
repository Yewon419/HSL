<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“ˆ ì£¼ì‹ ìŠ¤í¬ë¦¬ë‹ ì‹œìŠ¤í…œ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', Arial, sans-serif;
            background-color: #f8f9fa;
        }
        .navbar {
            box-shadow: 0 2px 4px rgba(0,0,0,.1);
        }
        .card {
            border: none;
            box-shadow: 0 0 10px rgba(0,0,0,.1);
        }
        .card-header {
            background-color: #fff;
            border-bottom: 2px solid #f0f0f0;
            font-weight: 600;
        }
        .condition-block {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 10px;
        }
        .strategy-item {
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 10px;
            background-color: #fff;
        }
        .strategy-item:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,.15);
        }
        .loading {
            text-align: center;
            padding: 20px;
            color: #6c757d;
        }
        .badge-condition {
            background-color: #e7f3ff;
            color: #0066cc;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 0.85em;
        }
    </style>
</head>
<body>
    <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary mb-4">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">
                <i class="fas fa-chart-line"></i> HSL ì£¼ì‹ ì‹œìŠ¤í…œ
            </a>
            <span class="navbar-text text-white">
                ìŠ¤í¬ë¦¬ë‹ & ë°±í…ŒìŠ¤íŒ…
            </span>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- ì™¼ìª½: ì „ëµ ì¶”ê°€ -->
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        <h6 class="mb-0"><i class="fas fa-plus"></i> <span id="form-title">ì „ëµ ì¶”ê°€</span></h6>
                    </div>
                    <div class="card-body">
                        <!-- ìƒë‹¨ ë²„íŠ¼ ì˜ì—­ -->
                        <div class="d-flex gap-2 mb-3" id="action-buttons">
                            <button type="button" class="btn btn-success flex-fill" onclick="submitStrategy()">
                                <i class="fas fa-save"></i> ì „ëµ ë“±ë¡
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="closeStrategyForm()" style="display:none;" id="close-btn">
                                <i class="fas fa-times"></i> ë‹«ê¸°
                            </button>
                        </div>

                        <form id="strategy-form" onsubmit="event.preventDefault(); submitStrategy();">
                            <div class="mb-3">
                                <label for="strategy-name" class="form-label">ì „ëµëª…</label>
                                <input type="text" class="form-control" id="strategy-name" placeholder="ì˜ˆ: ëª¨ë©˜í…€ ëŒíŒŒ ì „ëµ" required>
                            </div>
                            <div class="mb-3">
                                <label for="strategy-description" class="form-label">ì „ëµ ì„¤ëª…</label>
                                <textarea class="form-control" id="strategy-description" rows="2" placeholder="ì „ëµì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                            </div>

                            <div class="mb-3">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <label class="form-label mb-0">ìŠ¤í¬ë¦¬ë‹ ì¡°ê±´</label>
                                    <button type="button" class="btn btn-sm btn-outline-primary" onclick="addCondition()">
                                        <i class="fas fa-plus"></i> ì¡°ê±´ ì¶”ê°€
                                    </button>
                                </div>
                                <div id="conditions-container">
                                    <!-- ì¡°ê±´ë“¤ì´ ì—¬ê¸°ì— ì¶”ê°€ë©ë‹ˆë‹¤ -->
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="screen-start-date" class="form-label">ë¶„ì„ ì‹œì‘ì¼</label>
                                <input type="date" class="form-control" id="screen-start-date" required>
                            </div>
                            <div class="mb-3">
                                <label for="screen-end-date" class="form-label">ë¶„ì„ ì¢…ë£Œì¼</label>
                                <input type="date" class="form-control" id="screen-end-date" required>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- ì˜¤ë¥¸ìª½: ì „ëµ ëª©ë¡ -->
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h6 class="mb-0"><i class="fas fa-list"></i> ì „ëµ ëª©ë¡</h6>
                        <button id="refresh-strategies" class="btn btn-outline-primary btn-sm" onclick="loadStrategies()">
                            <i class="fas fa-sync"></i> ìƒˆë¡œê³ ì¹¨
                        </button>
                    </div>
                    <div class="card-body">
                        <div id="strategies-loading" class="loading" style="display: none;">
                            <i class="fas fa-spinner fa-spin"></i> ë¡œë”© ì¤‘...
                        </div>
                        <div id="strategies-list">
                            <!-- ì „ëµ ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast ì•Œë¦¼ -->
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
        <div id="notification-toast" class="toast" role="alert">
            <div class="toast-header">
                <i class="fas fa-info-circle me-2"></i>
                <strong class="me-auto">ì•Œë¦¼</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body" id="toast-message">
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const API_BASE_URL = '/api/v1/screening';
        let conditionCounter = 0;
        let availableIndicators = [];
        let originalStrategyData = null; // ì›ë³¸ ì „ëµ ë°ì´í„° ì €ì¥ìš©
        let isEditMode = false; // í¸ì§‘ ëª¨ë“œ ì—¬ë¶€

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            // ì˜¤ëŠ˜ ë‚ ì§œ ê¸°ë³¸ê°’ ì„¤ì •
            const today = new Date().toISOString().split('T')[0];
            const monthAgo = new Date(Date.now() - 30*24*60*60*1000).toISOString().split('T')[0];
            document.getElementById('screen-end-date').value = today;
            document.getElementById('screen-start-date').value = monthAgo;

            // ì§€í‘œ ë¡œë“œ
            loadIndicators();

            // ì „ëµ ëª©ë¡ ë¡œë“œ
            loadStrategies();
        });

        // ì§€í‘œ ëª©ë¡ ë¡œë“œ
        async function loadIndicators() {
            try {
                const response = await fetch(`${API_BASE_URL}/indicators`);
                availableIndicators = await response.json();
            } catch (error) {
                console.error('ì§€í‘œ ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        // ì¡°ê±´ ì¶”ê°€
        function addCondition() {
            const conditionId = conditionCounter++;
            const conditionHtml = `
                <div class="condition-block" data-condition-id="${conditionId}">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <strong>ì¡°ê±´ ${conditionId + 1}</strong>
                        <button type="button" class="btn btn-sm btn-danger" onclick="removeCondition(${conditionId})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    <div class="mb-2">
                        <label class="form-label small">ì§€í‘œ</label>
                        <select class="form-select form-select-sm" id="indicator-${conditionId}">
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            ${availableIndicators.map(ind => `<option value="${ind.code}">${ind.code} - ${ind.name}</option>`).join('')}
                        </select>
                    </div>
                    <div class="mb-2">
                        <label class="form-label small">ì¡°ê±´</label>
                        <select class="form-select form-select-sm" id="condition-${conditionId}">
                            <option value="golden_cross">ê³¨ë“ í¬ë¡œìŠ¤</option>
                            <option value="death_cross">ë°ë“œí¬ë¡œìŠ¤</option>
                            <option value="above">ì„ê³„ê°’ ì´ìƒ</option>
                            <option value="below">ì„ê³„ê°’ ì´í•˜</option>
                            <option value="between">ê°’ ë²”ìœ„</option>
                        </select>
                    </div>
                    <div class="row">
                        <div class="col-6">
                            <label class="form-label small">ê°’ 1</label>
                            <input type="number" class="form-control form-control-sm" id="value1-${conditionId}" placeholder="ì˜ˆ: 30">
                        </div>
                        <div class="col-6">
                            <label class="form-label small">ê°’ 2</label>
                            <input type="number" class="form-control form-control-sm" id="value2-${conditionId}" placeholder="ì˜ˆ: 70">
                        </div>
                    </div>
                    <div class="mt-2">
                        <label class="form-label small">ì¡°íšŒ ê¸°ê°„ (ì¼)</label>
                        <input type="number" class="form-control form-control-sm" id="lookback-${conditionId}" value="5" min="1" max="30">
                    </div>
                </div>
            `;
            document.getElementById('conditions-container').insertAdjacentHTML('beforeend', conditionHtml);
        }

        // ì¡°ê±´ ì‚­ì œ
        function removeCondition(conditionId) {
            const element = document.querySelector(`[data-condition-id="${conditionId}"]`);
            if (element) element.remove();
        }

        // ì¡°ê±´ ìˆ˜ì§‘
        function getConditions() {
            const conditions = [];
            document.querySelectorAll('.condition-block').forEach(block => {
                const id = block.getAttribute('data-condition-id');
                const indicator = document.getElementById(`indicator-${id}`).value;
                const condition = document.getElementById(`condition-${id}`).value;
                const lookback = parseInt(document.getElementById(`lookback-${id}`).value) || 5;
                const value1 = document.getElementById(`value1-${id}`).value;
                const value2 = document.getElementById(`value2-${id}`).value;

                if (indicator && condition) {
                    const conditionObj = {
                        indicator,
                        condition,
                        lookback_days: lookback
                    };
                    if (value1) conditionObj.value = parseFloat(value1);
                    if (value2) conditionObj.value2 = parseFloat(value2);
                    conditions.push(conditionObj);
                }
            });
            return conditions;
        }

        // ì „ëµ ì €ì¥
        async function saveStrategy(e) {
            if (e) e.preventDefault();

            const name = document.getElementById('strategy-name').value;
            const description = document.getElementById('strategy-description').value;
            const conditions = getConditions();

            if (conditions.length === 0) {
                showToast('ìµœì†Œ 1ê°œ ì´ìƒì˜ ì¡°ê±´ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”.', 'warning');
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/strategies`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, description, conditions })
                });

                if (response.ok) {
                    showToast('ì „ëµì´ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                    resetForm();
                    loadStrategies();
                } else {
                    const error = await response.json();
                    showToast('ì „ëµ ì €ì¥ ì‹¤íŒ¨: ' + error.detail, 'danger');
                }
            } catch (error) {
                showToast('ì˜¤ë¥˜ ë°œìƒ: ' + error.message, 'danger');
            }
        }

        // ì „ëµ ì œì¶œ (ë²„íŠ¼ í´ë¦­ìš©)
        function submitStrategy() {
            saveStrategy(null);
        }

        // í¼ ì´ˆê¸°í™”
        function resetForm() {
            document.getElementById('strategy-form').reset();
            document.getElementById('conditions-container').innerHTML = '';
            conditionCounter = 0;
            originalStrategyData = null;
            isEditMode = false;
            document.getElementById('form-title').textContent = 'ì „ëµ ì¶”ê°€';
            document.getElementById('close-btn').style.display = 'none';
        }

        // í¼ ë³€ê²½ì‚¬í•­ í™•ì¸
        function hasFormChanged() {
            if (!originalStrategyData) return false;

            const currentName = document.getElementById('strategy-name').value;
            const currentDescription = document.getElementById('strategy-description').value;
            const currentConditions = getConditions();

            // ì „ëµëª… ë˜ëŠ” ì„¤ëª…ì´ ë³€ê²½ë˜ì—ˆëŠ”ì§€ í™•ì¸
            if (currentName !== originalStrategyData.name ||
                currentDescription !== (originalStrategyData.description || '')) {
                return true;
            }

            // ì¡°ê±´ ê°œìˆ˜ê°€ ë³€ê²½ë˜ì—ˆëŠ”ì§€ í™•ì¸
            if (currentConditions.length !== originalStrategyData.conditions.length) {
                return true;
            }

            // ê° ì¡°ê±´ì´ ë³€ê²½ë˜ì—ˆëŠ”ì§€ í™•ì¸
            for (let i = 0; i < currentConditions.length; i++) {
                const current = currentConditions[i];
                const original = originalStrategyData.conditions[i];

                if (current.indicator !== original.indicator ||
                    current.condition !== original.condition ||
                    current.value !== original.value ||
                    current.value2 !== original.value2 ||
                    current.lookback_days !== original.lookback_days) {
                    return true;
                }
            }

            return false;
        }

        // í¼ ë‹«ê¸°
        function closeStrategyForm() {
            if (hasFormChanged()) {
                if (!confirm('ë³€ê²½ì‚¬í•­ì´ ìˆìŠµë‹ˆë‹¤. ì €ì¥í•˜ì§€ ì•Šê³  ë‹«ìœ¼ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    return;
                }
            }
            resetForm();
            showToast('í¸ì§‘ì„ ì·¨ì†Œí–ˆìŠµë‹ˆë‹¤.', 'info');
        }

        // ì „ëµ ëª©ë¡ ë¡œë“œ
        async function loadStrategies() {
            const loadingDiv = document.getElementById('strategies-loading');
            const listDiv = document.getElementById('strategies-list');

            loadingDiv.style.display = 'block';
            listDiv.innerHTML = '';

            try {
                const response = await fetch(`${API_BASE_URL}/strategies`);
                const data = await response.json();

                loadingDiv.style.display = 'none';

                // ê¸°ë³¸ ì „ëµ
                if (data.default_strategies && data.default_strategies.length > 0) {
                    listDiv.innerHTML += '<h6 class="text-muted mb-3"><i class="fas fa-star"></i> ê¸°ë³¸ ì „ëµ</h6>';
                    data.default_strategies.forEach(strategy => {
                        listDiv.innerHTML += createStrategyCard(strategy, true);
                    });
                }

                // ì‚¬ìš©ì ì „ëµ
                if (data.strategies && data.strategies.length > 0) {
                    listDiv.innerHTML += '<h6 class="text-muted mb-3 mt-4"><i class="fas fa-user"></i> ì‚¬ìš©ì ì „ëµ</h6>';
                    data.strategies.forEach(strategy => {
                        listDiv.innerHTML += createStrategyCard(strategy, false);
                    });
                } else if (!data.default_strategies || data.default_strategies.length === 0) {
                    listDiv.innerHTML = '<p class="text-muted text-center">ì €ì¥ëœ ì „ëµì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                }
            } catch (error) {
                loadingDiv.style.display = 'none';
                showToast('ì „ëµ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨: ' + error.message, 'danger');
            }
        }

        // ì „ëµ ì¹´ë“œ ìƒì„±
        function createStrategyCard(strategy, isDefault) {
            return `
                <div class="strategy-item">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div>
                            <h6 class="mb-1">${strategy.name}</h6>
                            <p class="text-muted small mb-2">${strategy.description || ''}</p>
                            <span class="badge-condition">ì¡°ê±´ ${strategy.conditions.length}ê°œ</span>
                        </div>
                    </div>
                    <div class="d-flex gap-2 mt-3">
                        <button class="btn btn-sm btn-outline-primary" onclick="loadStrategyConditions('${strategy.name}')">
                            <i class="fas fa-edit"></i> ì¡°ê±´ ë¶ˆëŸ¬ì˜¤ê¸°
                        </button>
                        <button class="btn btn-sm btn-success" onclick="executeStrategy('${strategy.name}')">
                            <i class="fas fa-play"></i> ìŠ¤í¬ë¦° ì‹¤í–‰
                        </button>
                        ${!isDefault ? `<button class="btn btn-sm btn-danger" onclick="deleteStrategy('${strategy.name}')">
                            <i class="fas fa-trash"></i> ì‚­ì œ
                        </button>` : ''}
                    </div>
                </div>
            `;
        }

        // ì „ëµ ì¡°ê±´ ë¶ˆëŸ¬ì˜¤ê¸°
        async function loadStrategyConditions(strategyName) {
            try {
                const response = await fetch(`${API_BASE_URL}/strategies`);
                const data = await response.json();

                const allStrategies = [...(data.strategies || []), ...(data.default_strategies || [])];
                const strategy = allStrategies.find(s => s.name === strategyName);

                if (!strategy) {
                    showToast('ì „ëµì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                    return;
                }

                // ì›ë³¸ ë°ì´í„° ì €ì¥ (ê¹Šì€ ë³µì‚¬)
                originalStrategyData = JSON.parse(JSON.stringify(strategy));
                isEditMode = true;

                // UI ì—…ë°ì´íŠ¸
                document.getElementById('form-title').textContent = 'ì „ëµ ì¡°ê±´ í™•ì¸/ìˆ˜ì •';
                document.getElementById('close-btn').style.display = 'block';

                // í¼ ì´ˆê¸°í™”
                document.getElementById('strategy-name').value = strategy.name;
                document.getElementById('strategy-description').value = strategy.description || '';
                document.getElementById('conditions-container').innerHTML = '';
                conditionCounter = 0;

                // ì¡°ê±´ ë¡œë“œ
                strategy.conditions.forEach(condition => {
                    addCondition();
                    const id = conditionCounter - 1;
                    setTimeout(() => {
                        document.getElementById(`indicator-${id}`).value = condition.indicator;
                        document.getElementById(`condition-${id}`).value = condition.condition;
                        if (condition.value) document.getElementById(`value1-${id}`).value = condition.value;
                        if (condition.value2) document.getElementById(`value2-${id}`).value = condition.value2;
                        document.getElementById(`lookback-${id}`).value = condition.lookback_days || 5;
                    }, 100);
                });

                showToast(`ì „ëµ '${strategyName}' ì¡°ê±´ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.`, 'success');

                // í¼ ì˜ì—­ìœ¼ë¡œ ìŠ¤í¬ë¡¤
                document.querySelector('.col-md-4').scrollIntoView({ behavior: 'smooth', block: 'start' });
            } catch (error) {
                showToast('ì¡°ê±´ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ' + error.message, 'danger');
            }
        }

        // ì „ëµ ì‹¤í–‰
        async function executeStrategy(strategyName) {
            const startDate = document.getElementById('screen-start-date').value;
            const endDate = document.getElementById('screen-end-date').value;

            if (!startDate || !endDate) {
                showToast('ë¶„ì„ ê¸°ê°„ì„ ì„¤ì •í•´ì£¼ì„¸ìš”.', 'warning');
                return;
            }

            try {
                showToast(`'${strategyName}' ì „ëµ ì‹¤í–‰ ì¤‘...`, 'info');

                const response = await fetch(`${API_BASE_URL}/strategies/${encodeURIComponent(strategyName)}/execute?start_date=${startDate}&end_date=${endDate}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                const data = await response.json();

                if (response.ok) {
                    // ë§¤ë§¤ì‹ í˜¸ íƒ­ì— ë°ì´í„° ì €ì¥
                    await saveToSignals(data, strategyName);
                    showToast(`ìŠ¤í¬ë¦¬ë‹ ì™„ë£Œ! ${data.results.total_matches}ê°œ ì¢…ëª© ë°œê²¬`, 'success');
                } else {
                    showToast('ì „ëµ ì‹¤í–‰ ì‹¤íŒ¨: ' + data.detail, 'danger');
                }
            } catch (error) {
                showToast('ì˜¤ë¥˜ ë°œìƒ: ' + error.message, 'danger');
            }
        }

        // ë§¤ë§¤ì‹ í˜¸ íƒ­ì— ì €ì¥
        async function saveToSignals(screeningData, strategyName) {
            if (!screeningData.results || !screeningData.results.results) return;

            const signals = screeningData.results.results.map(stock => ({
                ticker: stock.ticker,
                company_name: stock.company_name,
                country: stock.country || 'KR',
                sector: stock.sector || '',
                signal_date: stock.date,
                strategy_name: strategyName,
                current_price: stock.current_price,
                signal_reason: `ìŠ¤í¬ë¦¬ë‹ ì¡°ê±´ ë§Œì¡± (${screeningData.results.total_matches}ê°œ ì¤‘)`
            }));

            try {
                // ë§¤ë§¤ ì‹ í˜¸ API ì—”ë“œí¬ì¸íŠ¸ì— ì €ì¥
                const response = await fetch('/api/trading/signals/bulk', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ signals })
                });

                if (response.ok) {
                    const result = await response.json();
                    console.log('ë§¤ë§¤ì‹ í˜¸ íƒ­ì— ì €ì¥ ì™„ë£Œ:', result.message);
                    showToast(result.message, 'success');
                }
            } catch (error) {
                console.error('ë§¤ë§¤ì‹ í˜¸ ì €ì¥ ì‹¤íŒ¨:', error);
            }
        }

        // ì „ëµ ì‚­ì œ
        async function deleteStrategy(strategyName) {
            if (!confirm(`'${strategyName}' ì „ëµì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;

            try {
                const response = await fetch(`${API_BASE_URL}/strategies/${encodeURIComponent(strategyName)}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    showToast('ì „ëµì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    loadStrategies();
                } else {
                    const error = await response.json();
                    showToast('ì‚­ì œ ì‹¤íŒ¨: ' + error.detail, 'danger');
                }
            } catch (error) {
                showToast('ì˜¤ë¥˜ ë°œìƒ: ' + error.message, 'danger');
            }
        }

        // Toast ì•Œë¦¼ í‘œì‹œ
        function showToast(message, type = 'info') {
            const toastEl = document.getElementById('notification-toast');
            const toastBody = document.getElementById('toast-message');
            toastBody.textContent = message;

            const toast = new bootstrap.Toast(toastEl);
            toast.show();
        }
    </script>
</body>
</html>
