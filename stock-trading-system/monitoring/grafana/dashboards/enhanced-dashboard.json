{
  "dashboard": {
    "id": null,
    "uid": "enhanced-dashboard-001",
    "title": "Enhanced Stock Analysis Dashboard",
    "tags": ["stock", "technical-analysis", "indicators", "dynamic"],
    "timezone": "browser",
    "schemaVersion": 38,
    "version": 1,
    "refresh": "30s",
    "templating": {
      "list": [
        {
          "name": "ticker",
          "type": "query",
          "current": {
            "text": "005930 - 삼성전자",
            "value": "005930"
          },
          "options": [
            {
              "text": "005930 - 삼성전자",
              "value": "005930",
              "selected": true
            }
          ],
          "datasource": {
            "type": "postgres",
            "uid": "PCC52D03280B7034C"
          },
          "definition": "SELECT ticker AS __value, ticker || ' - ' || company_name AS __text FROM stocks WHERE is_active = true AND ticker IN (SELECT DISTINCT ticker FROM stock_prices WHERE date >= CURRENT_DATE - INTERVAL '30 days') ORDER BY company_name",
          "hide": 0,
          "includeAll": false,
          "multi": false,
          "label": "종목선택",
          "refresh": 1,
          "regex": "",
          "skipUrlSync": false,
          "sort": 0
        },
        {
          "name": "show_sma20",
          "type": "custom",
          "current": {
            "text": "Yes",
            "value": "1"
          },
          "options": [
            {"text": "Yes", "value": "1"},
            {"text": "No", "value": "0"}
          ],
          "hide": 0,
          "label": "SMA 20",
          "refresh": 0
        },
        {
          "name": "show_sma50",
          "type": "custom",
          "current": {
            "text": "Yes",
            "value": "1"
          },
          "options": [
            {"text": "Yes", "value": "1"},
            {"text": "No", "value": "0"}
          ],
          "hide": 0,
          "label": "SMA 50",
          "refresh": 0
        },
        {
          "name": "show_sma200",
          "type": "custom",
          "current": {
            "text": "No",
            "value": "0"
          },
          "options": [
            {"text": "Yes", "value": "1"},
            {"text": "No", "value": "0"}
          ],
          "hide": 0,
          "label": "SMA 200",
          "refresh": 0
        },
        {
          "name": "show_ema",
          "type": "custom",
          "current": {
            "text": "No",
            "value": "0"
          },
          "options": [
            {"text": "Yes", "value": "1"},
            {"text": "No", "value": "0"}
          ],
          "hide": 0,
          "label": "EMA",
          "refresh": 0
        },
        {
          "name": "show_bb",
          "type": "custom",
          "current": {
            "text": "Yes",
            "value": "1"
          },
          "options": [
            {"text": "Yes", "value": "1"},
            {"text": "No", "value": "0"}
          ],
          "hide": 0,
          "label": "Bollinger Bands",
          "refresh": 0
        },
        {
          "name": "show_volume",
          "type": "custom",
          "current": {
            "text": "Yes",
            "value": "1"
          },
          "options": [
            {"text": "Yes", "value": "1"},
            {"text": "No", "value": "0"}
          ],
          "hide": 0,
          "label": "Volume",
          "refresh": 0
        },
        {
          "name": "show_macd",
          "type": "custom",
          "current": {
            "text": "Yes",
            "value": "1"
          },
          "options": [
            {"text": "Yes", "value": "1"},
            {"text": "No", "value": "0"}
          ],
          "hide": 0,
          "label": "MACD",
          "refresh": 0
        },
        {
          "name": "show_rsi",
          "type": "custom",
          "current": {
            "text": "Yes",
            "value": "1"
          },
          "options": [
            {"text": "Yes", "value": "1"},
            {"text": "No", "value": "0"}
          ],
          "hide": 0,
          "label": "RSI",
          "refresh": 0
        },
        {
          "name": "show_stochastic",
          "type": "custom",
          "current": {
            "text": "Yes",
            "value": "1"
          },
          "options": [
            {"text": "Yes", "value": "1"},
            {"text": "No", "value": "0"}
          ],
          "hide": 0,
          "label": "Stochastic (%K, %D)",
          "refresh": 0
        }
      ]
    },
    "panels": [
      {
        "id": 1,
        "gridPos": {"h": 10, "w": 24, "x": 0, "y": 0},
        "type": "timeseries",
        "title": "Price & Moving Averages",
        "datasource": {
          "type": "postgres",
          "uid": "PCC52D03280B7034C"
        },
        "targets": [
          {
            "rawSql": "SELECT \n  date AS time,\n  close_price AS \"Price\"\nFROM stock_prices\nWHERE ticker = '$ticker'\n  AND date >= NOW() - INTERVAL '30 days'\nORDER BY date",
            "format": "time_series",
            "refId": "A"
          },
          {
            "rawSql": "SELECT \n  date AS time,\n  CASE WHEN $show_sma20 = 1 THEN\n    (SELECT (value->>'sma_20')::numeric FROM indicator_values iv JOIN indicator_definitions id ON iv.indicator_id = id.id WHERE iv.ticker = '$ticker' AND id.code = 'SMA' AND iv.date = sp.date)\n  END AS \"SMA 20\"\nFROM stock_prices sp\nWHERE ticker = '$ticker'\n  AND date >= NOW() - INTERVAL '30 days'\n  AND $show_sma20 = 1\nORDER BY date",
            "format": "time_series",
            "refId": "B"
          },
          {
            "rawSql": "SELECT \n  date AS time,\n  CASE WHEN $show_sma50 = 1 THEN\n    (SELECT (value->>'sma_50')::numeric FROM indicator_values iv JOIN indicator_definitions id ON iv.indicator_id = id.id WHERE iv.ticker = '$ticker' AND id.code = 'SMA' AND iv.date = sp.date)\n  END AS \"SMA 50\"\nFROM stock_prices sp\nWHERE ticker = '$ticker'\n  AND date >= NOW() - INTERVAL '30 days'\n  AND $show_sma50 = 1\nORDER BY date",
            "format": "time_series",
            "refId": "C"
          },
          {
            "rawSql": "SELECT \n  date AS time,\n  CASE WHEN $show_sma200 = 1 THEN\n    (SELECT (value->>'sma_200')::numeric FROM indicator_values iv JOIN indicator_definitions id ON iv.indicator_id = id.id WHERE iv.ticker = '$ticker' AND id.code = 'SMA' AND iv.date = sp.date)\n  END AS \"SMA 200\"\nFROM stock_prices sp\nWHERE ticker = '$ticker'\n  AND date >= NOW() - INTERVAL '30 days'\n  AND $show_sma200 = 1\nORDER BY date",
            "format": "time_series",
            "refId": "D"
          },
          {
            "rawSql": "SELECT \n  date AS time,\n  CASE WHEN $show_ema = 1 THEN\n    (SELECT (value->>'ema_20')::numeric FROM indicator_values iv JOIN indicator_definitions id ON iv.indicator_id = id.id WHERE iv.ticker = '$ticker' AND id.code = 'EMA' AND iv.date = sp.date)\n  END AS \"EMA 20\"\nFROM stock_prices sp\nWHERE ticker = '$ticker'\n  AND date >= NOW() - INTERVAL '30 days'\n  AND $show_ema = 1\nORDER BY date",
            "format": "time_series",
            "refId": "E"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "color": {"mode": "palette-classic"},
            "custom": {
              "axisLabel": "Price",
              "axisPlacement": "auto",
              "barAlignment": 0,
              "drawStyle": "line",
              "fillOpacity": 0,
              "gradientMode": "none",
              "hideFrom": {"tooltip": false, "viz": false, "legend": false},
              "lineInterpolation": "linear",
              "lineWidth": 2,
              "pointSize": 5,
              "scaleDistribution": {"type": "linear"},
              "showPoints": "never",
              "spanNulls": true,
              "stacking": {"group": "A", "mode": "none"}
            },
            "unit": "currencyKRW"
          },
          "overrides": [
            {
              "matcher": {"id": "byName", "options": "Price"},
              "properties": [
                {"id": "color", "value": {"fixedColor": "green", "mode": "fixed"}},
                {"id": "custom.lineWidth", "value": 3}
              ]
            },
            {
              "matcher": {"id": "byName", "options": "SMA 20"},
              "properties": [{"id": "color", "value": {"fixedColor": "blue", "mode": "fixed"}}]
            },
            {
              "matcher": {"id": "byName", "options": "SMA 50"},
              "properties": [{"id": "color", "value": {"fixedColor": "orange", "mode": "fixed"}}]
            },
            {
              "matcher": {"id": "byName", "options": "SMA 200"},
              "properties": [{"id": "color", "value": {"fixedColor": "red", "mode": "fixed"}}]
            },
            {
              "matcher": {"id": "byName", "options": "EMA 20"},
              "properties": [
                {"id": "color", "value": {"fixedColor": "purple", "mode": "fixed"}},
                {"id": "custom.lineStyle", "value": {"dash": [5, 5], "fill": "dash"}}
              ]
            }
          ]
        }
      },
      {
        "id": 2,
        "gridPos": {"h": 6, "w": 24, "x": 0, "y": 10},
        "type": "timeseries",
        "title": "Bollinger Bands",
        "datasource": {
          "type": "postgres",
          "uid": "PCC52D03280B7034C"
        },
        "targets": [
          {
            "rawSql": "SELECT \n  date AS time,\n  close_price AS \"Price\",\n  CASE WHEN $show_bb = 1 THEN\n    (SELECT (value->>'bb_upper')::numeric FROM indicator_values iv JOIN indicator_definitions id ON iv.indicator_id = id.id WHERE iv.ticker = '$ticker' AND id.code = 'BB' AND iv.date = sp.date)\n  END AS \"BB Upper\",\n  CASE WHEN $show_bb = 1 THEN\n    (SELECT (value->>'bb_middle')::numeric FROM indicator_values iv JOIN indicator_definitions id ON iv.indicator_id = id.id WHERE iv.ticker = '$ticker' AND id.code = 'BB' AND iv.date = sp.date)\n  END AS \"BB Middle\",\n  CASE WHEN $show_bb = 1 THEN\n    (SELECT (value->>'bb_lower')::numeric FROM indicator_values iv JOIN indicator_definitions id ON iv.indicator_id = id.id WHERE iv.ticker = '$ticker' AND id.code = 'BB' AND iv.date = sp.date)\n  END AS \"BB Lower\"\nFROM stock_prices sp\nWHERE ticker = '$ticker'\n  AND date >= NOW() - INTERVAL '30 days'\nORDER BY date",
            "format": "time_series",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "custom": {
              "drawStyle": "line",
              "lineInterpolation": "linear",
              "lineWidth": 1,
              "fillOpacity": 10,
              "gradientMode": "none",
              "spanNulls": true,
              "showPoints": "never"
            },
            "unit": "currencyKRW"
          },
          "overrides": [
            {
              "matcher": {"id": "byName", "options": "Price"},
              "properties": [
                {"id": "color", "value": {"fixedColor": "green", "mode": "fixed"}},
                {"id": "custom.lineWidth", "value": 2}
              ]
            },
            {
              "matcher": {"id": "byName", "options": "BB Upper"},
              "properties": [
                {"id": "color", "value": {"fixedColor": "red", "mode": "fixed"}},
                {"id": "custom.fillBelowTo", "value": "BB Lower"},
                {"id": "custom.fillOpacity", "value": 20}
              ]
            },
            {
              "matcher": {"id": "byName", "options": "BB Middle"},
              "properties": [
                {"id": "color", "value": {"fixedColor": "blue", "mode": "fixed"}},
                {"id": "custom.lineStyle", "value": {"dash": [3, 3], "fill": "dash"}}
              ]
            },
            {
              "matcher": {"id": "byName", "options": "BB Lower"},
              "properties": [{"id": "color", "value": {"fixedColor": "red", "mode": "fixed"}}]
            }
          ]
        }
      },
      {
        "id": 3,
        "gridPos": {"h": 5, "w": 24, "x": 0, "y": 16},
        "type": "timeseries",
        "title": "Volume",
        "datasource": {
          "type": "postgres",
          "uid": "PCC52D03280B7034C"
        },
        "targets": [
          {
            "rawSql": "SELECT \n  date AS time,\n  CASE WHEN $show_volume = 1 THEN volume END AS \"Volume\"\nFROM stock_prices\nWHERE ticker = '$ticker'\n  AND date >= NOW() - INTERVAL '30 days'\n  AND $show_volume = 1\nORDER BY date",
            "format": "time_series",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "custom": {
              "drawStyle": "bars",
              "lineInterpolation": "linear",
              "barAlignment": 0,
              "lineWidth": 1,
              "fillOpacity": 50,
              "gradientMode": "none",
              "spanNulls": false,
              "showPoints": "never"
            },
            "color": {"mode": "palette-classic"}
          }
        }
      },
      {
        "id": 4,
        "gridPos": {"h": 6, "w": 12, "x": 0, "y": 21},
        "type": "timeseries",
        "title": "MACD",
        "datasource": {
          "type": "postgres",
          "uid": "PCC52D03280B7034C"
        },
        "targets": [
          {
            "rawSql": "SELECT \n  date AS time,\n  CASE WHEN $show_macd = 1 THEN (value->>'macd')::numeric END AS \"MACD\",\n  CASE WHEN $show_macd = 1 THEN (value->>'macd_signal')::numeric END AS \"Signal\",\n  CASE WHEN $show_macd = 1 THEN (value->>'macd_histogram')::numeric END AS \"Histogram\"\nFROM indicator_values iv\nJOIN indicator_definitions id ON iv.indicator_id = id.id\nWHERE iv.ticker = '$ticker'\n  AND id.code = 'MACD'\n  AND date >= NOW() - INTERVAL '30 days'\n  AND $show_macd = 1\nORDER BY date",
            "format": "time_series",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "custom": {
              "drawStyle": "line",
              "lineInterpolation": "linear",
              "barAlignment": 0,
              "lineWidth": 2,
              "fillOpacity": 10,
              "gradientMode": "none",
              "spanNulls": true,
              "showPoints": "never"
            }
          },
          "overrides": [
            {
              "matcher": {"id": "byName", "options": "Histogram"},
              "properties": [
                {"id": "custom.drawStyle", "value": "bars"},
                {"id": "custom.fillOpacity", "value": 50},
                {"id": "color", "value": {"fixedColor": "light-blue", "mode": "fixed"}}
              ]
            },
            {
              "matcher": {"id": "byName", "options": "MACD"},
              "properties": [{"id": "color", "value": {"fixedColor": "blue", "mode": "fixed"}}]
            },
            {
              "matcher": {"id": "byName", "options": "Signal"},
              "properties": [{"id": "color", "value": {"fixedColor": "red", "mode": "fixed"}}]
            }
          ]
        }
      },
      {
        "id": 5,
        "gridPos": {"h": 6, "w": 8, "x": 12, "y": 21},
        "type": "timeseries",
        "title": "RSI",
        "datasource": {
          "type": "postgres",
          "uid": "PCC52D03280B7034C"
        },
        "targets": [
          {
            "rawSql": "SELECT \n  date AS time,\n  CASE WHEN $show_rsi = 1 THEN (value->>'rsi')::numeric END AS \"RSI\"\nFROM indicator_values iv\nJOIN indicator_definitions id ON iv.indicator_id = id.id\nWHERE iv.ticker = '$ticker'\n  AND id.code = 'RSI'\n  AND date >= NOW() - INTERVAL '30 days'\n  AND $show_rsi = 1\nORDER BY date",
            "format": "time_series",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "min": 0,
            "max": 100,
            "custom": {
              "drawStyle": "line",
              "lineInterpolation": "linear",
              "lineWidth": 2,
              "fillOpacity": 10,
              "gradientMode": "none",
              "spanNulls": true,
              "showPoints": "never"
            },
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "red", "value": null},
                {"color": "yellow", "value": 30},
                {"color": "green", "value": 40},
                {"color": "green", "value": 60},
                {"color": "yellow", "value": 70},
                {"color": "red", "value": 80}
              ]
            }
          }
        },
        "options": {
          "legend": {"calcs": ["last"], "displayMode": "list", "placement": "bottom"},
          "tooltip": {"mode": "single"}
        }
      },
      {
        "id": 10,
        "gridPos": {"h": 6, "w": 4, "x": 20, "y": 21},
        "type": "timeseries",
        "title": "Stochastic (%K, %D) - Stockcast",
        "datasource": {
          "type": "postgres",
          "uid": "PCC52D03280B7034C"
        },
        "targets": [
          {
            "rawSql": "SELECT \n  date AS time,\n  (value->>'stoch_k')::numeric AS \"%K\",\n  (value->>'stoch_d')::numeric AS \"%D\"\nFROM indicator_values iv\nJOIN indicator_definitions id ON iv.indicator_id = id.id\nWHERE iv.ticker = '$ticker'\n  AND id.code = 'STOCH'\n  AND date >= NOW() - INTERVAL '30 days'\nORDER BY date",
            "format": "time_series",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "min": 0,
            "max": 100,
            "custom": {
              "drawStyle": "line",
              "lineInterpolation": "linear",
              "lineWidth": 2,
              "fillOpacity": 10,
              "gradientMode": "none",
              "spanNulls": true,
              "showPoints": "never"
            },
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "red", "value": null},
                {"color": "yellow", "value": 20},
                {"color": "green", "value": 30},
                {"color": "green", "value": 70},
                {"color": "yellow", "value": 80},
                {"color": "red", "value": 90}
              ]
            }
          },
          "overrides": [
            {
              "matcher": {"id": "byName", "options": "%K"},
              "properties": [
                {"id": "color", "value": {"fixedColor": "blue", "mode": "fixed"}},
                {"id": "custom.lineWidth", "value": 2}
              ]
            },
            {
              "matcher": {"id": "byName", "options": "%D"},
              "properties": [
                {"id": "color", "value": {"fixedColor": "red", "mode": "fixed"}},
                {"id": "custom.lineWidth", "value": 2}
              ]
            }
          ]
        },
        "options": {
          "legend": {"calcs": ["last"], "displayMode": "list", "placement": "bottom"},
          "tooltip": {"mode": "single"}
        }
      },
      {
        "id": 6,
        "gridPos": {"h": 4, "w": 5, "x": 0, "y": 27},
        "type": "stat",
        "title": "Current Price",
        "datasource": {
          "type": "postgres",
          "uid": "PCC52D03280B7034C"
        },
        "targets": [
          {
            "rawSql": "SELECT close_price \nFROM stock_prices \nWHERE ticker = '$ticker' \nORDER BY date DESC \nLIMIT 1",
            "format": "table",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "currencyKRW",
            "color": {"mode": "thresholds"},
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "green", "value": null}
              ]
            }
          }
        }
      },
      {
        "id": 7,
        "gridPos": {"h": 4, "w": 5, "x": 5, "y": 27},
        "type": "stat",
        "title": "Daily Change %",
        "datasource": {
          "type": "postgres",
          "uid": "PCC52D03280B7034C"
        },
        "targets": [
          {
            "rawSql": "WITH daily_change AS (\n  SELECT \n    close_price,\n    LAG(close_price) OVER (ORDER BY date) as prev_close\n  FROM stock_prices \n  WHERE ticker = '$ticker' \n  ORDER BY date DESC \n  LIMIT 2\n)\nSELECT \n  ROUND(((close_price - prev_close) / prev_close * 100)::numeric, 2) as change_percent\nFROM daily_change\nWHERE prev_close IS NOT NULL",
            "format": "table",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "percent",
            "color": {"mode": "thresholds"},
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "red", "value": -5},
                {"color": "orange", "value": -2},
                {"color": "yellow", "value": 0},
                {"color": "light-green", "value": 2},
                {"color": "green", "value": 5}
              ]
            }
          }
        }
      },
      {
        "id": 8,
        "gridPos": {"h": 4, "w": 5, "x": 10, "y": 27},
        "type": "stat",
        "title": "Latest RSI",
        "datasource": {
          "type": "postgres",
          "uid": "PCC52D03280B7034C"
        },
        "targets": [
          {
            "rawSql": "SELECT (value->>'rsi')::numeric as rsi\nFROM indicator_values iv\nJOIN indicator_definitions id ON iv.indicator_id = id.id\nWHERE iv.ticker = '$ticker'\n  AND id.code = 'RSI'\nORDER BY date DESC\nLIMIT 1",
            "format": "table",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "min": 0,
            "max": 100,
            "color": {"mode": "thresholds"},
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "red", "value": null},
                {"color": "yellow", "value": 30},
                {"color": "green", "value": 40},
                {"color": "green", "value": 60},
                {"color": "yellow", "value": 70},
                {"color": "red", "value": 80}
              ]
            }
          }
        }
      },
      {
        "id": 9,
        "gridPos": {"h": 4, "w": 4, "x": 15, "y": 27},
        "type": "stat",
        "title": "Trading Signal",
        "datasource": {
          "type": "postgres",
          "uid": "PCC52D03280B7034C"
        },
        "targets": [
          {
            "rawSql": "WITH latest_rsi AS (\n  SELECT (value->>'rsi')::numeric as rsi\n  FROM indicator_values iv\n  JOIN indicator_definitions id ON iv.indicator_id = id.id\n  WHERE iv.ticker = '$ticker' AND id.code = 'RSI'\n  ORDER BY date DESC LIMIT 1\n)\nSELECT \n  CASE \n    WHEN rsi < 30 THEN 'BUY'\n    WHEN rsi > 70 THEN 'SELL'\n    ELSE 'HOLD'\n  END as signal\nFROM latest_rsi",
            "format": "table",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "color": {"mode": "value"},
            "mappings": [
              {"type": "value", "value": "BUY", "options": {"color": "green", "index": 0}},
              {"type": "value", "value": "SELL", "options": {"color": "red", "index": 1}},
              {"type": "value", "value": "HOLD", "options": {"color": "yellow", "index": 2}}
            ]
          }
        }
      },
      {
        "id": 11,
        "gridPos": {"h": 4, "w": 5, "x": 19, "y": 27},
        "type": "stat",
        "title": "Stochastic %K",
        "datasource": {
          "type": "postgres",
          "uid": "PCC52D03280B7034C"
        },
        "targets": [
          {
            "rawSql": "SELECT (value->>'stoch_k')::numeric as stoch_k\nFROM indicator_values iv\nJOIN indicator_definitions id ON iv.indicator_id = id.id\nWHERE iv.ticker = '$ticker'\n  AND id.code = 'STOCH'\nORDER BY date DESC\nLIMIT 1",
            "format": "table",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "min": 0,
            "max": 100,
            "color": {"mode": "thresholds"},
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "red", "value": null},
                {"color": "yellow", "value": 20},
                {"color": "green", "value": 30},
                {"color": "green", "value": 70},
                {"color": "yellow", "value": 80},
                {"color": "red", "value": 90}
              ]
            }
          }
        }
      }
    ],
    "time": {
      "from": "now-30d",
      "to": "now"
    },
    "timepicker": {
      "refresh_intervals": ["5s", "10s", "30s", "1m", "5m", "15m", "30m", "1h", "2h", "1d"],
      "time_options": ["5m", "15m", "1h", "6h", "12h", "24h", "2d", "7d", "30d", "90d", "180d", "1y"]
    }
  },
  "overwrite": true
}