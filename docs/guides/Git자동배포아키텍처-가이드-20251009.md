# GitHub Actions ìë™ ë°°í¬ ì•„í‚¤í…ì²˜ ì™„ë²½ ê°€ì´ë“œ

**ì‘ì„±ì¼**: 2025-10-09
**ë¬¸ì„œ ìœ í˜•**: ê°€ì´ë“œ
**ëŒ€ìƒ**: DevOps, ê°œë°œì

---

## ğŸ“‹ ëª©ì°¨

1. [ê°œìš”](#ê°œìš”)
2. [ì „ì²´ ì•„í‚¤í…ì²˜](#ì „ì²´-ì•„í‚¤í…ì²˜)
3. [êµ¬ì„± ìš”ì†Œ ìƒì„¸ ì„¤ëª…](#êµ¬ì„±-ìš”ì†Œ-ìƒì„¸-ì„¤ëª…)
4. [ë°°í¬ íë¦„ ìƒì„¸](#ë°°í¬-íë¦„-ìƒì„¸)
5. [í™˜ê²½ ì„¤ì •](#í™˜ê²½-ì„¤ì •)
6. [ë³´ì•ˆ ë° ì¸ì¦](#ë³´ì•ˆ-ë°-ì¸ì¦)
7. [ë¬¸ì œ í•´ê²°](#ë¬¸ì œ-í•´ê²°)
8. [ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤](#ë² ìŠ¤íŠ¸-í”„ë™í‹°ìŠ¤)

---

## ê°œìš”

### ì‹œìŠ¤í…œ ëª©ì 

ë¡œì»¬ ê°œë°œ í™˜ê²½ì—ì„œ ì½”ë“œ ë³€ê²½ í›„ `git push`ë§Œìœ¼ë¡œ 3ëŒ€ ìš´ì˜ ì„œë²„ì— ìë™ìœ¼ë¡œ ë°°í¬ë˜ëŠ” CI/CD íŒŒì´í”„ë¼ì¸

### í•µì‹¬ ê¸°ìˆ  ìŠ¤íƒ

- **ë²„ì „ ê´€ë¦¬**: Git / GitHub
- **CI/CD**: GitHub Actions
- **ì»¨í…Œì´ë„ˆ**: Docker / Docker Compose
- **ë°°í¬ ë°©ì‹**: SSH ì›ê²© ì‹¤í–‰
- **í™˜ê²½ ê´€ë¦¬**: .env íŒŒì¼ ê¸°ë°˜ í™˜ê²½ ë¶„ë¦¬

### ë°°í¬ ëŒ€ìƒ ì„œë²„

| ì„œë²„ | IP | ì—­í•  | ë°°í¬ ëŒ€ìƒ |
|-----|-----|------|----------|
| 101 | 192.168.219.101 | Scheduler/Monitoring | Grafana, Airflow |
| 102 | 192.168.219.102 | Backend/Worker | Backend API, Celery Worker/Beat |
| 103 | 192.168.219.103 | Database | PostgreSQL, Redis, InfluxDB |

> **Note**: 103 ì„œë²„ëŠ” ë°ì´í„°ë² ì´ìŠ¤ ì „ìš©ì´ë¯€ë¡œ ìë™ ë°°í¬ ëŒ€ìƒì´ ì•„ë‹™ë‹ˆë‹¤.

---

## ì „ì²´ ì•„í‚¤í…ì²˜

### ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ë¡œì»¬ ê°œë°œ í™˜ê²½ (Windows PC)                        â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚   ê°œë°œì     â”‚â”€â”€â”€>â”‚  Git ì‘ì—…   â”‚â”€â”€â”€>â”‚ Git Push    â”‚                 â”‚
â”‚  â”‚   ì½”ë”©      â”‚    â”‚  Commit     â”‚    â”‚ to GitHub   â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                               â”‚                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                â”‚
                                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          GitHub (í´ë¼ìš°ë“œ)                                 â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                     GitHub Repository                             â”‚   â”‚
â”‚  â”‚                 (chohkcloud/happystocklife)                       â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚   â”‚
â”‚  â”‚  â”‚ main ë¸Œëœì¹˜ â”‚  â”‚  .env ì œì™¸ â”‚  â”‚  ì†ŒìŠ¤ì½”ë“œë§Œ      â”‚           â”‚   â”‚
â”‚  â”‚  â”‚   ì½”ë“œ      â”‚  â”‚  (ë³´ì•ˆ)    â”‚  â”‚  ë²„ì „ ê´€ë¦¬       â”‚           â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚            â”‚                                                             â”‚
â”‚            â”‚ Push ê°ì§€ (Webhook)                                         â”‚
â”‚            â–¼                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚               GitHub Actions Workflow                             â”‚   â”‚
â”‚  â”‚            (.github/workflows/deploy.yml)                         â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  Trigger: push to main                                            â”‚   â”‚
â”‚  â”‚  Runner: ubuntu-latest (GitHub ì œê³µ VM)                           â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚  Job 1: deploy-102-backend                                  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚Checkoutâ”‚â†’â”‚SSH Setupâ”‚â†’â”‚Deploy  â”‚â†’â”‚Verify  â”‚              â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ Code   â”‚ â”‚ Key     â”‚ â”‚Script  â”‚ â”‚Status  â”‚              â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                            â”‚ Success                               â”‚   â”‚
â”‚  â”‚                            â–¼                                       â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚  Job 2: deploy-101-scheduler                                â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚Checkoutâ”‚â†’â”‚SSH Setupâ”‚â†’â”‚Deploy  â”‚â†’â”‚Verify  â”‚              â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ Code   â”‚ â”‚ Key     â”‚ â”‚Script  â”‚ â”‚Status  â”‚              â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                            â”‚ Success                               â”‚   â”‚
â”‚  â”‚                            â–¼                                       â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚  Job 3: health-check                                        â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚Backend API   â”‚ â”‚Grafana API   â”‚ â”‚Success       â”‚       â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚Health Check  â”‚ â”‚Health Check  â”‚ â”‚Notification  â”‚       â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                             â”‚ SSH ì—°ê²°                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                           â”‚
        â–¼                                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  102 ì„œë²„ (Backend)       â”‚          â”‚  101 ì„œë²„ (Scheduler)     â”‚
â”‚  192.168.219.102         â”‚          â”‚  192.168.219.101         â”‚
â”‚                          â”‚          â”‚                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Git Pull           â”‚  â”‚          â”‚  â”‚ Git Pull           â”‚  â”‚
â”‚  â”‚ (ìµœì‹  ì½”ë“œ ë°›ê¸°)    â”‚  â”‚          â”‚  â”‚ (ìµœì‹  ì½”ë“œ ë°›ê¸°)    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚            â–¼             â”‚          â”‚            â–¼             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Docker Compose     â”‚  â”‚          â”‚  â”‚ Docker Compose     â”‚  â”‚
â”‚  â”‚ Down (ì¤‘ì§€)        â”‚  â”‚          â”‚  â”‚ Down (ì¤‘ì§€)        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚            â–¼             â”‚          â”‚            â–¼             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Docker Build       â”‚  â”‚          â”‚  â”‚ Docker Build       â”‚  â”‚
â”‚  â”‚ (ì´ë¯¸ì§€ ì¬ë¹Œë“œ)     â”‚  â”‚          â”‚  â”‚ (ì´ë¯¸ì§€ ì¬ë¹Œë“œ)     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚            â–¼             â”‚          â”‚            â–¼             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Docker Up -d       â”‚  â”‚          â”‚  â”‚ Docker Up -d       â”‚  â”‚
â”‚  â”‚ (ë°±ê·¸ë¼ìš´ë“œ ì‹œì‘)   â”‚  â”‚          â”‚  â”‚ (ë°±ê·¸ë¼ìš´ë“œ ì‹œì‘)   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚            â–¼             â”‚          â”‚            â–¼             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ì»¨í…Œì´ë„ˆ ì‹¤í–‰ í™•ì¸  â”‚  â”‚          â”‚  â”‚ ì»¨í…Œì´ë„ˆ ì‹¤í–‰ í™•ì¸  â”‚  â”‚
â”‚  â”‚ - stock-backend    â”‚  â”‚          â”‚  â”‚ - stock-grafana    â”‚  â”‚
â”‚  â”‚ - stock-celery-*   â”‚  â”‚          â”‚  â”‚ - stock-airflow-*  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â”‚          â”‚                          â”‚
â”‚  ì—°ê²° â†“                   â”‚          â”‚  ì—°ê²° â†“                   â”‚
â””â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                     â”‚
       â”‚                                     â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  103 ì„œë²„ (Database)      â”‚
        â”‚  192.168.219.103         â”‚
        â”‚                          â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚  â”‚ PostgreSQL         â”‚  â”‚
        â”‚  â”‚ (ì£¼ê°€ ë°ì´í„°)       â”‚  â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚  â”‚ Redis              â”‚  â”‚
        â”‚  â”‚ (ìºì‹œ/í)          â”‚  â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚  â”‚ InfluxDB           â”‚  â”‚
        â”‚  â”‚ (ì‹œê³„ì—´ ë©”íŠ¸ë¦­)     â”‚  â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â”‚                          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## êµ¬ì„± ìš”ì†Œ ìƒì„¸ ì„¤ëª…

### 1. ë¡œì»¬ ê°œë°œ í™˜ê²½

#### ì—­í• 
- ì½”ë“œ ì‘ì„± ë° í…ŒìŠ¤íŠ¸
- Git ì»¤ë°‹ ë° Push
- ê°œë°œ í™˜ê²½ Docker Composeë¡œ ë¡œì»¬ í…ŒìŠ¤íŠ¸

#### ì£¼ìš” íŒŒì¼
```
F:\hhstock\
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â””â”€â”€ deploy.yml          # GitHub Actions ì›Œí¬í”Œë¡œìš°
â”œâ”€â”€ stock-trading-system/
â”‚   â”œâ”€â”€ backend/
â”‚   â”‚   â”œâ”€â”€ config.py           # í™˜ê²½ ë³€ìˆ˜ ê¸°ë°˜ ì„¤ì •
â”‚   â”‚   â”œâ”€â”€ requirements.txt    # Python ì˜ì¡´ì„±
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ .env.example            # í™˜ê²½ ë³€ìˆ˜ í…œí”Œë¦¿
â”‚   â”œâ”€â”€ .env.development        # ê°œë°œ í™˜ê²½ ì„¤ì • (Git ì œì™¸)
â”‚   â”œâ”€â”€ docker-compose.yml      # ë² ì´ìŠ¤ ì„¤ì •
â”‚   â”œâ”€â”€ docker-compose.dev.yml  # ê°œë°œ í™˜ê²½ ì˜¤ë²„ë¼ì´ë“œ
â”‚   â””â”€â”€ docker-compose.prod.yml # ìš´ì˜ í™˜ê²½ ì˜¤ë²„ë¼ì´ë“œ
â””â”€â”€ .gitignore                  # .env íŒŒì¼ ì œì™¸
```

#### ê°œë°œ ì›Œí¬í”Œë¡œìš°
```bash
# 1. ë¡œì»¬ ê°œë°œ
cd F:\hhstock
docker-compose -f stock-trading-system/docker-compose.yml \
               -f stock-trading-system/docker-compose.dev.yml up

# 2. ì½”ë“œ ìˆ˜ì • í›„ í…ŒìŠ¤íŠ¸

# 3. Git ì»¤ë°‹
git add .
git commit -m "feat: ìƒˆë¡œìš´ ê¸°ëŠ¥ ì¶”ê°€"

# 4. GitHub Push (ìë™ ë°°í¬ íŠ¸ë¦¬ê±°)
git push origin main
```

### 2. GitHub Repository

#### ì—­í• 
- ì†ŒìŠ¤ ì½”ë“œ ë²„ì „ ê´€ë¦¬
- GitHub Actions ì‹¤í–‰ í™˜ê²½ ì œê³µ
- Webhookì„ í†µí•œ ë°°í¬ íŠ¸ë¦¬ê±°

#### ì €ì¥ì†Œ êµ¬ì¡°
```
Repository: chohkcloud/happystocklife
â”œâ”€â”€ main ë¸Œëœì¹˜ (protected)
â”œâ”€â”€ .github/workflows/deploy.yml (CI/CD ì •ì˜)
â”œâ”€â”€ ì†ŒìŠ¤ ì½”ë“œ (ì¶”ì )
â””â”€â”€ .env íŒŒì¼ (ì œì™¸ - .gitignore)
```

#### GitHub Secrets
```
Settings â†’ Secrets and variables â†’ Actions

SSH_PRIVATE_KEY: ì„œë²„ SSH ì ‘ì†ìš© Private Key
```

**ë³´ì•ˆ ì›ì¹™**
- âœ… ì†ŒìŠ¤ ì½”ë“œë§Œ Git ì¶”ì 
- âœ… í™˜ê²½ ë³€ìˆ˜ (.env) ì œì™¸
- âœ… SSH KeyëŠ” GitHub Secretsì— ì•”í˜¸í™” ì €ì¥
- âŒ ë¯¼ê° ì •ë³´ ì ˆëŒ€ ì»¤ë°‹ ê¸ˆì§€

### 3. GitHub Actions Runner

#### ì—­í• 
- GitHubì´ ì œê³µí•˜ëŠ” ê°€ìƒ ë¨¸ì‹  (ubuntu-latest)
- Workflow ì‹¤í–‰ í™˜ê²½
- SSH í´ë¼ì´ì–¸íŠ¸ë¡œ ì„œë²„ ì ‘ì†

#### Workflow íŒŒì¼ êµ¬ì¡°

**`.github/workflows/deploy.yml`**
```yaml
name: Deploy to Production Servers

on:
  push:
    branches:
      - main               # main ë¸Œëœì¹˜ Push ì‹œ íŠ¸ë¦¬ê±°
  workflow_dispatch:       # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥

jobs:
  # Job 1: 102 ì„œë²„ ë°°í¬
  deploy-102-backend:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
      - name: Setup SSH key
      - name: Deploy to 102 Server

  # Job 2: 101 ì„œë²„ ë°°í¬ (Job 1 ì„±ê³µ í›„)
  deploy-101-scheduler:
    needs: deploy-102-backend
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
      - name: Setup SSH key
      - name: Deploy to 101 Server

  # Job 3: Health Check (Job 2 ì„±ê³µ í›„)
  health-check:
    needs: [deploy-102-backend, deploy-101-scheduler]
    runs-on: ubuntu-latest
    steps:
      - name: Check Backend API
      - name: Check Grafana
```

#### Runner í™˜ê²½
```
OS: Ubuntu 22.04 LTS
CPU: 2 cores
RAM: 7 GB
Disk: 14 GB SSD
Network: GitHub Actions IP ëŒ€ì—­
```

### 4. ìš´ì˜ ì„œë²„ (101, 102)

#### ì‚¬ì „ ì„¤ì • ìš”êµ¬ì‚¬í•­

**1) Git ì €ì¥ì†Œ Clone**
```bash
cd ~
git clone https://github.com/chohkcloud/happystocklife.git stock-trading-system
cd stock-trading-system
```

**2) .env.production íŒŒì¼ ìƒì„±**
```bash
# í…œí”Œë¦¿ ë³µì‚¬
cp stock-trading-system/.env.production.example \
   stock-trading-system/.env.production

# ì‹¤ì œ ê°’ìœ¼ë¡œ ìˆ˜ì •
nano stock-trading-system/.env.production
```

**ì˜ˆì‹œ (.env.production)**
```env
ENVIRONMENT=production
DB_HOST=192.168.219.103
DB_PORT=5432
DB_NAME=stocktrading
DB_USER=admin
DB_PASSWORD=admin123
REDIS_HOST=192.168.219.103
REDIS_PORT=6379
INFLUXDB_URL=http://192.168.219.103:8086
JWT_SECRET_KEY=production-secret-key-change-this
```

**3) SSH Public Key ë“±ë¡**
```bash
# ë¡œì»¬ì—ì„œ Public Key í™•ì¸
cat ~/.ssh/id_rsa.pub

# ì„œë²„ì—ì„œ authorized_keysì— ì¶”ê°€
mkdir -p ~/.ssh
echo "ssh-rsa AAAA..." >> ~/.ssh/authorized_keys
chmod 600 ~/.ssh/authorized_keys
chmod 700 ~/.ssh
```

#### ì„œë²„ë³„ ë°°í¬ ìŠ¤í¬ë¦½íŠ¸

**102 ì„œë²„ ë°°í¬ íë¦„**
```bash
# 1. ìµœì‹  ì½”ë“œ ë°›ê¸°
cd /home/hansol/stock-trading-system
git pull origin main

# 2. ì»¨í…Œì´ë„ˆ ì¤‘ì§€
docker-compose down

# 3. ì´ë¯¸ì§€ ì¬ë¹Œë“œ
ENVIRONMENT=production docker-compose \
    -f docker-compose.yml \
    -f docker-compose.prod.yml \
    build

# 4. ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘
ENVIRONMENT=production docker-compose \
    -f docker-compose.yml \
    -f docker-compose.prod.yml \
    up -d

# 5. ì»¨í…Œì´ë„ˆ ìƒíƒœ í™•ì¸
docker ps | grep stock-backend
docker ps | grep stock-celery
```

**101 ì„œë²„ ë°°í¬ íë¦„**
```bash
# ë™ì¼í•œ íë¦„, í™•ì¸ ëŒ€ìƒë§Œ ë‹¤ë¦„
docker ps | grep stock-grafana
docker ps | grep stock-airflow
```

---

## ë°°í¬ íë¦„ ìƒì„¸

### ì „ì²´ íƒ€ì„ë¼ì¸

```
T+0s   : ê°œë°œìê°€ git push origin main
T+5s   : GitHub Webhookì´ Actions íŠ¸ë¦¬ê±°
T+10s  : Runner VM ìƒì„± ë° Checkout
T+15s  : Job 1 ì‹œì‘ - 102 ì„œë²„ SSH ì—°ê²°
T+20s  : 102 ì„œë²„ git pull
T+25s  : 102 ì„œë²„ docker-compose down
T+30s  : 102 ì„œë²„ docker build (1-3ë¶„)
T+3m   : 102 ì„œë²„ docker up -d
T+3m5s : 102 ì„œë²„ ì»¨í…Œì´ë„ˆ ìƒíƒœ í™•ì¸
T+3m10s: Job 1 ì™„ë£Œ âœ…
T+3m15s: Job 2 ì‹œì‘ - 101 ì„œë²„ SSH ì—°ê²°
T+3m20s: 101 ì„œë²„ git pull
T+3m25s: 101 ì„œë²„ docker-compose down
T+3m30s: 101 ì„œë²„ docker build (1-2ë¶„)
T+5m   : 101 ì„œë²„ docker up -d
T+5m5s : 101 ì„œë²„ ì»¨í…Œì´ë„ˆ ìƒíƒœ í™•ì¸
T+5m10s: Job 2 ì™„ë£Œ âœ…
T+5m15s: Job 3 ì‹œì‘ - Health Check
T+5m20s: Backend API Health Check
T+5m22s: Grafana Health Check
T+5m25s: Job 3 ì™„ë£Œ âœ…
T+5m30s: ë°°í¬ ì™„ë£Œ! ğŸ‰
```

### Step-by-Step ìƒì„¸ ì„¤ëª…

#### Step 1: Git Push (ë¡œì»¬ â†’ GitHub)

**ì‹¤í–‰ ìœ„ì¹˜**: ë¡œì»¬ PC

```bash
cd F:\hhstock
git push origin main
```

**ë‚´ë¶€ ë™ì‘**
1. Gitì´ ë¡œì»¬ ì»¤ë°‹ì„ GitHubì— ì „ì†¡
2. GitHubì´ Push ì´ë²¤íŠ¸ ìˆ˜ì‹ 
3. `.github/workflows/deploy.yml` íŒŒì¼ í™•ì¸
4. `on.push.branches: main` ì¡°ê±´ ë§¤ì¹­
5. Workflow íì— ì¶”ê°€

#### Step 2: GitHub Actions ì‹œì‘

**ì‹¤í–‰ ìœ„ì¹˜**: GitHub í´ë¼ìš°ë“œ

**Runner VM ìƒì„±**
```
- OS: Ubuntu 22.04
- Docker ì‚¬ì „ ì„¤ì¹˜ë¨
- Git ì‚¬ì „ ì„¤ì¹˜ë¨
- Node.js, Python ë“± ê¸°ë³¸ íˆ´ í¬í•¨
```

**Checkout ì½”ë“œ**
```yaml
- name: Checkout code
  uses: actions/checkout@v3
```

ë‚´ë¶€ ë™ì‘:
```bash
# GitHubì´ ìë™ ì‹¤í–‰
git clone --depth 1 https://github.com/chohkcloud/happystocklife.git
cd happystocklife
git checkout main
```

#### Step 3: SSH ì„¤ì •

**ì‹¤í–‰ ìœ„ì¹˜**: GitHub Actions Runner

```yaml
- name: Setup SSH key
  run: |
    mkdir -p ~/.ssh
    echo "${{ secrets.SSH_PRIVATE_KEY }}" > ~/.ssh/id_rsa
    chmod 600 ~/.ssh/id_rsa
    ssh-keyscan -H 192.168.219.102 >> ~/.ssh/known_hosts
```

**ìƒì„¸ ë™ì‘**
1. `~/.ssh` ë””ë ‰í† ë¦¬ ìƒì„±
2. GitHub Secretsì—ì„œ Private Key ì½ì–´ì„œ íŒŒì¼ ìƒì„±
3. íŒŒì¼ ê¶Œí•œ 600ìœ¼ë¡œ ì„¤ì • (ë³´ì•ˆ)
4. ì„œë²„ì˜ Host Keyë¥¼ `known_hosts`ì— ì¶”ê°€ (ì¤‘ê°„ì ê³µê²© ë°©ì§€)

**SSH ì¸ì¦ íë¦„**
```
Runner                          102 Server
  â”‚                                â”‚
  â”œâ”€ SSH ì—°ê²° ìš”ì²­ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚  (Private Keyë¡œ ì„œëª…)           â”‚
  â”‚                                â”‚
  â”‚<â”€ Challenge â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                â”‚
  â”œâ”€ ì„œëª…ëœ ì‘ë‹µ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                                â”‚
  â”‚                                â”œâ”€ Public Keyë¡œ ê²€ì¦
  â”‚                                â”‚  (~/.ssh/authorized_keys)
  â”‚                                â”‚
  â”‚<â”€ ì¸ì¦ ì„±ê³µ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                â”‚
  â”œâ”€ ëª…ë ¹ ì‹¤í–‰ ê°€ëŠ¥ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
```

#### Step 4: 102 ì„œë²„ ë°°í¬

**ì‹¤í–‰ ìœ„ì¹˜**: GitHub Actions Runner (SSHë¡œ 102 ì„œë²„ ëª…ë ¹ ì‹¤í–‰)

```yaml
- name: Deploy to 102 Server
  run: |
    ssh hansol@192.168.219.102 << 'EOF'
      set -e  # ì—ëŸ¬ ì‹œ ì¦‰ì‹œ ì¢…ë£Œ

      # í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ë¡œ ì´ë™
      cd /home/hansol/stock-trading-system

      # ìµœì‹  ì½”ë“œ ë°›ê¸°
      git pull origin main

      # ê¸°ì¡´ ì»¨í…Œì´ë„ˆ ì¤‘ì§€
      docker-compose down

      # ìš´ì˜ í™˜ê²½ìœ¼ë¡œ ì¬ë¹Œë“œ
      ENVIRONMENT=production docker-compose \
          -f docker-compose.yml \
          -f docker-compose.prod.yml \
          build

      # ë°±ê·¸ë¼ìš´ë“œë¡œ ì¬ì‹œì‘
      ENVIRONMENT=production docker-compose \
          -f docker-compose.yml \
          -f docker-compose.prod.yml \
          up -d

      # ì»¨í…Œì´ë„ˆ ì‹œì‘ ëŒ€ê¸°
      sleep 15

      # ì»¨í…Œì´ë„ˆ ìƒíƒœ í™•ì¸
      docker ps | grep stock-backend
      docker ps | grep stock-celery

      echo "âœ… 102 Server deployment completed"
    EOF
```

**Docker Compose ë™ì‘ ìƒì„¸**

1. **docker-compose down**
   ```bash
   # ì‹¤í–‰ ì¤‘ì¸ ì»¨í…Œì´ë„ˆ í™•ì¸
   $ docker ps
   CONTAINER ID   IMAGE                    STATUS
   abc123         stock-backend:latest     Up 5 days
   def456         stock-celery-worker      Up 5 days

   # ì»¨í…Œì´ë„ˆ ì¤‘ì§€ ë° ì œê±°
   $ docker-compose down
   Stopping stock-backend ... done
   Stopping stock-celery-worker ... done
   Removing stock-backend ... done
   Removing stock-celery-worker ... done
   Removing network stock-network ... done
   ```

2. **docker-compose build**
   ```bash
   # Dockerfile ê¸°ë°˜ ì´ë¯¸ì§€ ë¹Œë“œ
   $ docker-compose build

   Building backend...
   Step 1/10 : FROM python:3.11-slim
   Step 2/10 : WORKDIR /app
   Step 3/10 : COPY requirements.txt .
   Step 4/10 : RUN pip install -r requirements.txt
   Step 5/10 : COPY . .
   ...
   Successfully built abc123def456
   Successfully tagged stock-backend:latest
   ```

3. **docker-compose up -d**
   ```bash
   # ë°±ê·¸ë¼ìš´ë“œë¡œ ì»¨í…Œì´ë„ˆ ì‹œì‘
   $ docker-compose up -d

   Creating network "stock-network" ... done
   Creating stock-backend ... done
   Creating stock-celery-worker ... done
   Creating stock-celery-beat ... done
   ```

**í™˜ê²½ ë³€ìˆ˜ ë¡œë”© íë¦„**
```
docker-compose.yml
  â†“ env_file ì§€ì •
.env.production (ì„œë²„ì—ë§Œ ì¡´ì¬)
  â†“ í™˜ê²½ ë³€ìˆ˜ ë¡œë“œ
config.py (Pydantic Settings)
  â†“ ìë™ ë³€í™˜
DATABASE_URL, REDIS_URL ë“± ìƒì„±
  â†“
ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰
```

#### Step 5: 101 ì„œë²„ ë°°í¬

**ì‹¤í–‰ ìœ„ì¹˜**: GitHub Actions Runner

**Job ì˜ì¡´ì„±**
```yaml
deploy-101-scheduler:
  needs: deploy-102-backend  # 102 ì„œë²„ ì„±ê³µ í›„ ì‹¤í–‰
```

**ë™ì‘**: 102 ì„œë²„ì™€ ë™ì¼, ëŒ€ìƒë§Œ ë‹¤ë¦„

#### Step 6: Health Check

**ì‹¤í–‰ ìœ„ì¹˜**: GitHub Actions Runner

```yaml
- name: Check Backend API
  run: |
    curl -f http://192.168.219.102:8000/health || exit 1
    echo "âœ… Backend API is healthy"

- name: Check Grafana
  run: |
    curl -f http://192.168.219.101:3000/api/health || exit 1
    echo "âœ… Grafana is healthy"
```

**Health Check ì—”ë“œí¬ì¸íŠ¸**

**Backend API (`/health`)**
```python
# backend/main.py
@app.get("/health")
async def health_check():
    return {
        "status": "healthy",
        "timestamp": datetime.now().isoformat(),
        "database": await check_db_connection(),
        "redis": await check_redis_connection()
    }
```

**Grafana API (`/api/health`)**
```json
{
  "commit": "abc123",
  "database": "ok",
  "version": "10.2.0"
}
```

**curl ì˜µì…˜ ì„¤ëª…**
- `-f`: HTTP ì—ëŸ¬ ì‹œ exit code 0ì´ ì•„ë‹Œ ê°’ ë°˜í™˜ (fail-fast)
- `||`: curl ì‹¤íŒ¨ ì‹œ ë‹¤ìŒ ëª…ë ¹ ì‹¤í–‰
- `exit 1`: Job ì‹¤íŒ¨ ì²˜ë¦¬

---

## í™˜ê²½ ì„¤ì •

### í™˜ê²½ ë³€ìˆ˜ ê´€ë¦¬ ì „ëµ

#### ë¡œì»¬ ê°œë°œ í™˜ê²½

**`.env.development` (Git ì œì™¸)**
```env
ENVIRONMENT=development
DB_HOST=localhost
DB_PORT=5435                    # ê°œë°œìš© í¬íŠ¸
REDIS_HOST=localhost
REDIS_PORT=6380                 # ê°œë°œìš© í¬íŠ¸
LOG_LEVEL=DEBUG
```

**ì‚¬ìš©ë²•**
```bash
# ê°œë°œ í™˜ê²½ìœ¼ë¡œ ì‹¤í–‰
docker-compose -f docker-compose.yml -f docker-compose.dev.yml up
```

#### ìš´ì˜ í™˜ê²½

**`.env.production` (Git ì œì™¸, ì„œë²„ì—ë§Œ ì¡´ì¬)**
```env
ENVIRONMENT=production
DB_HOST=192.168.219.103         # ìš´ì˜ DB ì„œë²„
DB_PORT=5432
REDIS_HOST=192.168.219.103
REDIS_PORT=6379
LOG_LEVEL=INFO
JWT_SECRET_KEY=strong-production-secret
```

**ì‚¬ìš©ë²•**
```bash
# ìš´ì˜ í™˜ê²½ìœ¼ë¡œ ì‹¤í–‰
ENVIRONMENT=production docker-compose \
    -f docker-compose.yml \
    -f docker-compose.prod.yml \
    up -d
```

#### í…œí”Œë¦¿ íŒŒì¼ (Git ì¶”ì )

**`.env.example`**
```env
# ëª¨ë“  í•„ìˆ˜ ë³€ìˆ˜ ë‚˜ì—´ (ê°’ì€ ì˜ˆì‹œ)
ENVIRONMENT=development
DB_HOST=localhost
DB_PORT=5432
DB_NAME=stocktrading
DB_USER=admin
DB_PASSWORD=change-this
```

**ëª©ì **
- ìƒˆ ê°œë°œì ì˜¨ë³´ë”© ì‹œ ì°¸ê³ 
- ì–´ë–¤ í™˜ê²½ ë³€ìˆ˜ê°€ í•„ìš”í•œì§€ ë¬¸ì„œí™”
- CI/CD ì„¤ì • ì‹œ ì°¸ê³ 

### config.py êµ¬ì¡°

**Pydantic Settings ê¸°ë°˜ ì„¤ì • ê´€ë¦¬**

```python
# stock-trading-system/backend/config.py
from pydantic_settings import BaseSettings
import os

class Settings(BaseSettings):
    # í™˜ê²½
    ENVIRONMENT: str = "development"

    # ë°ì´í„°ë² ì´ìŠ¤
    DB_HOST: str
    DB_PORT: int = 5432
    DB_NAME: str = "stocktrading"
    DB_USER: str = "admin"
    DB_PASSWORD: str

    # Redis
    REDIS_HOST: str
    REDIS_PORT: int = 6379

    # ìë™ ìƒì„± ì†ì„±
    @property
    def DATABASE_URL(self) -> str:
        return (f"postgresql://{self.DB_USER}:{self.DB_PASSWORD}"
                f"@{self.DB_HOST}:{self.DB_PORT}/{self.DB_NAME}")

    @property
    def REDIS_URL(self) -> str:
        return f"redis://{self.REDIS_HOST}:{self.REDIS_PORT}"

    class Config:
        # í™˜ê²½ì— ë”°ë¼ ë‹¤ë¥¸ .env íŒŒì¼ ë¡œë“œ
        env_file = f".env.{os.getenv('ENVIRONMENT', 'development')}"
        case_sensitive = True

# ì‹±ê¸€í†¤ ì¸ìŠ¤í„´ìŠ¤
settings = Settings()
```

**ì‚¬ìš© ì˜ˆì‹œ**
```python
# backend/database.py
from config import settings

engine = create_engine(settings.DATABASE_URL)

# backend/celery_app.py
from config import settings

celery_app = Celery(
    'stock_trading',
    broker=settings.CELERY_BROKER_URL,
    backend=settings.CELERY_RESULT_BACKEND
)
```

---

## ë³´ì•ˆ ë° ì¸ì¦

### SSH Key ê´€ë¦¬

#### 1. Key ìƒì„± (ë¡œì»¬)

```bash
ssh-keygen -t rsa -b 4096 -f ~/.ssh/id_rsa -N ""
```

**íŒŒì¼ êµ¬ì¡°**
```
~/.ssh/
â”œâ”€â”€ id_rsa          # Private Key (ë¹„ë°€, GitHub Secrets)
â””â”€â”€ id_rsa.pub      # Public Key (ê³µê°œ, ì„œë²„ì— ë“±ë¡)
```

#### 2. Public Key ì„œë²„ ë“±ë¡

**ë°©ë²• 1: ssh-copy-id (ê¶Œì¥)**
```bash
ssh-copy-id hansol@192.168.219.102
ssh-copy-id hansol@192.168.219.101
```

**ë°©ë²• 2: ìˆ˜ë™ ë“±ë¡**
```bash
# ë¡œì»¬ì—ì„œ Public Key ë³µì‚¬
cat ~/.ssh/id_rsa.pub

# ì„œë²„ì—ì„œ authorized_keysì— ì¶”ê°€
mkdir -p ~/.ssh
echo "ssh-rsa AAAA... your-key-here" >> ~/.ssh/authorized_keys
chmod 600 ~/.ssh/authorized_keys
chmod 700 ~/.ssh
```

#### 3. Private Key GitHub Secrets ë“±ë¡

**ê²½ë¡œ**: GitHub Repository â†’ Settings â†’ Secrets â†’ Actions

**Secret ì´ë¦„**: `SSH_PRIVATE_KEY`

**ê°’ ì…ë ¥**
```bash
# ë¡œì»¬ì—ì„œ Private Key ì „ì²´ ë‚´ìš© ë³µì‚¬
cat ~/.ssh/id_rsa

# ì¶œë ¥ ì˜ˆì‹œ (ì´ ì „ì²´ë¥¼ ë³µì‚¬)
-----BEGIN RSA PRIVATE KEY-----
MIIEpAIBAAKCAQEA...
...
-----END RSA PRIVATE KEY-----
```

**ì£¼ì˜ì‚¬í•­**
- âœ… í—¤ë”/í‘¸í„° í¬í•¨ (`-----BEGIN...-----`)
- âœ… ì¤„ë°”ê¿ˆ í¬í•¨ (ê·¸ëŒ€ë¡œ ë³µì‚¬)
- âŒ ì¶”ê°€ ê³µë°± ì—†ì´
- âŒ ë‹¤ë¥¸ í…ìŠ¤íŠ¸ í˜¼ì… ê¸ˆì§€

### í™˜ê²½ ë³€ìˆ˜ ë³´ì•ˆ

#### Gitì—ì„œ ì œì™¸ë˜ëŠ” íŒŒì¼

**`.gitignore`**
```gitignore
# í™˜ê²½ ë³€ìˆ˜ íŒŒì¼
.env
.env.development
.env.production
.env.staging
.env.local

# í…œí”Œë¦¿ì€ ì¶”ì 
!.env.example
!.env.*.example
```

#### ë¯¼ê° ì •ë³´ ë³´í˜¸ ì›ì¹™

**âŒ ì ˆëŒ€ ì»¤ë°‹í•˜ì§€ ë§ ê²ƒ**
```
DB_PASSWORD=ì‹¤ì œë¹„ë°€ë²ˆí˜¸
JWT_SECRET_KEY=ì‹¤ì œí‚¤
AWS_ACCESS_KEY=ì‹¤ì œí‚¤
```

**âœ… í…œí”Œë¦¿ í˜•íƒœë¡œ ì»¤ë°‹**
```
DB_PASSWORD=change-this-in-production
JWT_SECRET_KEY=generate-strong-key
AWS_ACCESS_KEY=your-access-key-here
```

#### ì„œë²„ í™˜ê²½ ë³€ìˆ˜ ê²€ì¦

```bash
# ì„œë²„ì—ì„œ ì‹¤ì œ í™˜ê²½ ë³€ìˆ˜ í™•ì¸
cd /home/hansol/stock-trading-system
cat stock-trading-system/.env.production

# Docker ì»¨í…Œì´ë„ˆì—ì„œ í™˜ê²½ ë³€ìˆ˜ í™•ì¸
docker exec stock-backend env | grep DB_
```

### ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆ

#### ë°©í™”ë²½ ì„¤ì •

**102 ì„œë²„**
```bash
# SSH (22) í—ˆìš©
sudo ufw allow 22/tcp

# Backend API (8000) - ë‚´ë¶€ë§ë§Œ
sudo ufw allow from 192.168.219.0/24 to any port 8000

# ë°©í™”ë²½ í™œì„±í™”
sudo ufw enable
```

**101 ì„œë²„**
```bash
# SSH (22) í—ˆìš©
sudo ufw allow 22/tcp

# Grafana (3000) - ë‚´ë¶€ë§ë§Œ
sudo ufw allow from 192.168.219.0/24 to any port 3000

# Airflow (8080) - ë‚´ë¶€ë§ë§Œ
sudo ufw allow from 192.168.219.0/24 to any port 8080
```

#### GitHub Actions IP í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸

**GitHub Actions IP ëŒ€ì—­** (2025ë…„ ê¸°ì¤€)
```
actions.github.comì—ì„œ ë™ì ìœ¼ë¡œ ë³€ê²½
```

**ê¶Œì¥ ì„¤ì •**: IP í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ ëŒ€ì‹  SSH Key ì¸ì¦ ì‚¬ìš© (í˜„ì¬ ë°©ì‹)

---

## ë¬¸ì œ í•´ê²°

### ì¼ë°˜ì ì¸ ë¬¸ì œ

#### 1. SSH ì—°ê²° ì‹¤íŒ¨

**ì¦ìƒ**
```
Permission denied (publickey)
```

**ì›ì¸**
- GitHub Secretsì˜ SSH_PRIVATE_KEY ì˜¤ë¥˜
- ì„œë²„ì˜ authorized_keys ë¯¸ë“±ë¡
- SSH ì„œë¹„ìŠ¤ ì¤‘ì§€

**í•´ê²°**
```bash
# 1. ì„œë²„ SSH ì„œë¹„ìŠ¤ í™•ì¸
sudo systemctl status ssh

# 2. authorized_keys í™•ì¸
cat ~/.ssh/authorized_keys

# 3. Public Key ì¬ë“±ë¡
ssh-copy-id hansol@192.168.219.102

# 4. GitHub Secrets ì¬í™•ì¸
# Private Key ì „ì²´ ë³µì‚¬í–ˆëŠ”ì§€ í™•ì¸
```

#### 2. Docker Build ì‹¤íŒ¨

**ì¦ìƒ**
```
ERROR: failed to solve: process "/bin/sh -c pip install -r requirements.txt" did not complete successfully
```

**ì›ì¸**
- ë””ìŠ¤í¬ ê³µê°„ ë¶€ì¡±
- requirements.txt ì˜ì¡´ì„± ì˜¤ë¥˜
- Docker ì´ë¯¸ì§€ ìºì‹œ ë¬¸ì œ

**í•´ê²°**
```bash
# 1. ë””ìŠ¤í¬ ê³µê°„ í™•ì¸
df -h

# 2. Docker ì •ë¦¬
docker system prune -a
docker volume prune

# 3. ë¹Œë“œ ìºì‹œ ë¬´ì‹œí•˜ê³  ì¬ë¹Œë“œ
docker-compose build --no-cache
```

#### 3. Health Check ì‹¤íŒ¨

**ì¦ìƒ**
```
curl: (7) Failed to connect to 192.168.219.102 port 8000: Connection refused
```

**ì›ì¸**
- ì»¨í…Œì´ë„ˆê°€ ì•„ì§ ì‹œì‘ ì¤‘
- ì• í”Œë¦¬ì¼€ì´ì…˜ í¬ë˜ì‹œ
- í¬íŠ¸ ë°”ì¸ë”© ì˜¤ë¥˜

**í•´ê²°**
```bash
# 1. ì»¨í…Œì´ë„ˆ ë¡œê·¸ í™•ì¸
docker-compose logs backend

# 2. ì»¨í…Œì´ë„ˆ ìƒíƒœ í™•ì¸
docker ps -a

# 3. í¬íŠ¸ ë°”ì¸ë”© í™•ì¸
docker port stock-backend

# 4. ëŒ€ê¸° ì‹œê°„ ëŠ˜ë¦¬ê¸° (deploy.yml)
sleep 15 â†’ sleep 30
```

### ë°°í¬ ë¡¤ë°±

#### GitHubì—ì„œ ë¡¤ë°±

**ë°©ë²• 1: ì´ì „ ì»¤ë°‹ìœ¼ë¡œ ë˜ëŒë¦¬ê¸°**
```bash
# ë¡œì»¬ì—ì„œ
git log --oneline -5
git revert <commit-hash>
git push origin main
# GitHub Actionsê°€ ìë™ìœ¼ë¡œ ë¡¤ë°± ë°°í¬
```

**ë°©ë²• 2: ì„œë²„ì—ì„œ ì§ì ‘ ë¡¤ë°±**
```bash
# ì„œë²„ì—ì„œ
cd /home/hansol/stock-trading-system
git log --oneline -5
git checkout <ì´ì „-commit-hash>
docker-compose down
ENVIRONMENT=production docker-compose \
    -f docker-compose.yml \
    -f docker-compose.prod.yml \
    up -d
```

### ë¡œê·¸ í™•ì¸

#### GitHub Actions ë¡œê·¸

**ê²½ë¡œ**: https://github.com/chohkcloud/happystocklife/actions

**í™•ì¸ ì‚¬í•­**
- ê° Jobì˜ ì„±ê³µ/ì‹¤íŒ¨ ì—¬ë¶€
- ì‹¤íŒ¨í•œ Stepì˜ ì—ëŸ¬ ë©”ì‹œì§€
- SSH ì—°ê²° ë¡œê·¸
- Docker ë¹Œë“œ ë¡œê·¸

#### ì„œë²„ ë¡œê·¸

**Backend ë¡œê·¸**
```bash
# 102 ì„œë²„
ssh hansol@192.168.219.102
cd /home/hansol/stock-trading-system
docker-compose logs -f backend --tail=100
```

**Celery Worker ë¡œê·¸**
```bash
docker-compose logs -f celery-worker --tail=100
```

**Grafana ë¡œê·¸**
```bash
# 101 ì„œë²„
ssh hansol@192.168.219.101
docker-compose logs -f grafana --tail=100
```

---

## ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤

### 1. ë°°í¬ ì „ ì²´í¬ë¦¬ìŠ¤íŠ¸

```markdown
- [ ] ë¡œì»¬ì—ì„œ í…ŒìŠ¤íŠ¸ ì™„ë£Œ
- [ ] .env íŒŒì¼ì´ Gitì— ì»¤ë°‹ë˜ì§€ ì•Šì•˜ëŠ”ì§€ í™•ì¸
- [ ] requirements.txt ì—…ë°ì´íŠ¸ í™•ì¸
- [ ] Docker Compose íŒŒì¼ ë¬¸ë²• ê²€ì¦
- [ ] ì»¤ë°‹ ë©”ì‹œì§€ê°€ ëª…í™•í•œì§€ í™•ì¸
- [ ] Breaking Changesê°€ ìˆë‹¤ë©´ ë¬¸ì„œí™”
```

### 2. ì ì§„ì  ë°°í¬ (Progressive Deployment)

**ë‹¨ê³„ë³„ ë°°í¬**
```
1. Feature Branchì—ì„œ ê°œë°œ
2. ë¡œì»¬ í…ŒìŠ¤íŠ¸
3. Pull Request ìƒì„±
4. ì½”ë“œ ë¦¬ë·°
5. main ë¸Œëœì¹˜ ë³‘í•©
6. ìë™ ë°°í¬
```

**Feature Branch ì „ëµ**
```bash
# 1. Feature Branch ìƒì„±
git checkout -b feature/new-indicator

# 2. ê°œë°œ ë° ì»¤ë°‹
git add .
git commit -m "feat: add new technical indicator"

# 3. Push (ìë™ ë°°í¬ ì•ˆ ë¨)
git push origin feature/new-indicator

# 4. Pull Request ìƒì„±
# GitHubì—ì„œ PR ìƒì„±

# 5. ë¦¬ë·° ë° ìŠ¹ì¸ í›„ ë³‘í•©
# main ë¸Œëœì¹˜ ë³‘í•© â†’ ìë™ ë°°í¬ íŠ¸ë¦¬ê±°
```

### 3. ëª¨ë‹ˆí„°ë§ ë° ì•Œë¦¼

#### Slack ì•Œë¦¼ ì¶”ê°€ (ì„ íƒ ì‚¬í•­)

**deploy.ymlì— ì¶”ê°€**
```yaml
- name: Notify Slack on Success
  if: success()
  uses: slackapi/slack-github-action@v1
  with:
    webhook-url: ${{ secrets.SLACK_WEBHOOK_URL }}
    payload: |
      {
        "text": "âœ… Deployment Success: ${{ github.sha }}"
      }

- name: Notify Slack on Failure
  if: failure()
  uses: slackapi/slack-github-action@v1
  with:
    webhook-url: ${{ secrets.SLACK_WEBHOOK_URL }}
    payload: |
      {
        "text": "âŒ Deployment Failed: ${{ github.sha }}"
      }
```

### 4. ì„±ëŠ¥ ìµœì í™”

#### Docker ì´ë¯¸ì§€ ìµœì í™”

**ë©€í‹° ìŠ¤í…Œì´ì§€ ë¹Œë“œ**
```dockerfile
# backend/Dockerfile
FROM python:3.11-slim AS builder
WORKDIR /app
COPY requirements.txt .
RUN pip install --user -r requirements.txt

FROM python:3.11-slim
WORKDIR /app
COPY --from=builder /root/.local /root/.local
COPY . .
ENV PATH=/root/.local/bin:$PATH
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]
```

**ë¹Œë“œ ì‹œê°„ ë‹¨ì¶•**
```yaml
# docker-compose.yml
services:
  backend:
    build:
      context: .
      dockerfile: backend/Dockerfile
      cache_from:
        - stock-backend:latest
```

### 5. ë³´ì•ˆ ê°•í™”

#### Docker ì»¨í…Œì´ë„ˆ ë³´ì•ˆ

**Non-root ì‚¬ìš©ìë¡œ ì‹¤í–‰**
```dockerfile
FROM python:3.11-slim
RUN useradd -m -u 1000 appuser
USER appuser
WORKDIR /home/appuser/app
```

**Read-only ë£¨íŠ¸ íŒŒì¼ì‹œìŠ¤í…œ**
```yaml
services:
  backend:
    read_only: true
    tmpfs:
      - /tmp
```

#### Secret ìŠ¤ìº”

**pre-commit hook ì¶”ê°€**
```bash
# .git/hooks/pre-commit
#!/bin/bash
if git diff --cached | grep -E "PASSWORD|SECRET|KEY|TOKEN" | grep -v "example"; then
    echo "âš ï¸ Warning: Possible secret detected!"
    exit 1
fi
```

---

## ì°¸ê³  ìë£Œ

### ê´€ë ¨ ë¬¸ì„œ

- [CICDí™˜ê²½ë¶„ë¦¬ì „ëµ-ê°€ì´ë“œ-20251009.md](../deployment/CICDí™˜ê²½ë¶„ë¦¬ì „ëµ-ê°€ì´ë“œ-20251009.md)
- [CICDíŒŒì´í”„ë¼ì¸êµ¬ì¶•-ê°œë°œ-20251009.md](../deployment/CICDíŒŒì´í”„ë¼ì¸êµ¬ì¶•-ê°œë°œ-20251009.md)
- [GitHub Actions CI/CD ê°€ì´ë“œ](../../.github/workflows/README.md)
- [3ì„œë²„Dockerë¶„ì‚°ë°°í¬-ê°œë°œ-20251008.md](../development-logs/3ì„œë²„Dockerë¶„ì‚°ë°°í¬-ê°œë°œ-20251008.md)

### ì™¸ë¶€ ë§í¬

- [GitHub Actions ê³µì‹ ë¬¸ì„œ](https://docs.github.com/en/actions)
- [Docker Compose ê³µì‹ ë¬¸ì„œ](https://docs.docker.com/compose/)
- [Pydantic Settings ë¬¸ì„œ](https://docs.pydantic.dev/latest/concepts/pydantic_settings/)

---

## ìš”ì•½

### í•µì‹¬ ì›Œí¬í”Œë¡œìš°

```
ë¡œì»¬ ê°œë°œ â†’ Git Commit â†’ Git Push â†’ GitHub Actions íŠ¸ë¦¬ê±°
â†’ SSHë¡œ 102 ì„œë²„ ì ‘ì† â†’ Git Pull â†’ Docker Rebuild â†’ ì¬ì‹œì‘
â†’ SSHë¡œ 101 ì„œë²„ ì ‘ì† â†’ Git Pull â†’ Docker Rebuild â†’ ì¬ì‹œì‘
â†’ Health Check â†’ ë°°í¬ ì™„ë£Œ âœ…
```

### ì£¼ìš” ì¥ì 

1. **ìë™í™”**: ìˆ˜ë™ ì‘ì—… ì œê±°, íœ´ë¨¼ ì—ëŸ¬ ê°ì†Œ
2. **ì¼ê´€ì„±**: ëª¨ë“  ë°°í¬ê°€ ë™ì¼í•œ í”„ë¡œì„¸ìŠ¤ë¡œ ì‹¤í–‰
3. **ì¶”ì  ê°€ëŠ¥ì„±**: Git ì»¤ë°‹ ì´ë ¥ìœ¼ë¡œ ëª¨ë“  ë³€ê²½ ì¶”ì 
4. **ë¡¤ë°± ìš©ì´**: Git ì´ë ¥ ê¸°ë°˜ ë¹ ë¥¸ ë¡¤ë°±
5. **ë³´ì•ˆ**: SSH Key ê¸°ë°˜ ì¸ì¦, í™˜ê²½ ë³€ìˆ˜ ë¶„ë¦¬

### ì£¼ì˜ì‚¬í•­

- âš ï¸ .env íŒŒì¼ ì ˆëŒ€ ì»¤ë°‹ ê¸ˆì§€
- âš ï¸ main ë¸Œëœì¹˜ Push ì‹œ ìë™ ë°°í¬ë¨ (ì‹ ì¤‘íˆ)
- âš ï¸ SSH Private Key ë³´ì•ˆ ìœ ì§€
- âš ï¸ ì„œë²„ .env.production íŒŒì¼ ìˆ˜ë™ ê´€ë¦¬ í•„ìš”

---

**ì‘ì„±ì¼**: 2025-10-09
**ìµœì¢… ì—…ë°ì´íŠ¸**: 2025-10-09
**ë¬¸ì„œ ë²„ì „**: 1.0
