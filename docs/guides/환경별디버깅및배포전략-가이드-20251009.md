# í™˜ê²½ë³„ ë””ë²„ê¹… ë° ë°°í¬ ì „ëµ ê°€ì´ë“œ

**ì‘ì„±ì¼**: 2025-10-09
**ë¬¸ì„œ ìœ í˜•**: ê°€ì´ë“œ
**ëŒ€ìƒ**: DevOps, ê°œë°œì

---

## ğŸ“‹ ëª©ì°¨

1. [ì§ˆë¬¸ 1: ìš´ì˜ í™˜ê²½ ì§ì ‘ ìˆ˜ì • ë¬¸ì œ](#ì§ˆë¬¸-1-ìš´ì˜-í™˜ê²½-ì§ì ‘-ìˆ˜ì •-ë¬¸ì œ)
2. [ì§ˆë¬¸ 2: ìš´ì˜ì—ì„œë§Œ ë°œìƒí•˜ëŠ” CORS ì—ëŸ¬](#ì§ˆë¬¸-2-ìš´ì˜ì—ì„œë§Œ-ë°œìƒí•˜ëŠ”-cors-ì—ëŸ¬)
3. [ì˜¬ë°”ë¥¸ ë°°í¬ ì›Œí¬í”Œë¡œìš°](#ì˜¬ë°”ë¥¸-ë°°í¬-ì›Œí¬í”Œë¡œìš°)
4. [í™˜ê²½ë³„ ë””ë²„ê¹… ì „ëµ](#í™˜ê²½ë³„-ë””ë²„ê¹…-ì „ëµ)
5. [ê¸´ê¸‰ í•«í”½ìŠ¤ í”„ë¡œì„¸ìŠ¤](#ê¸´ê¸‰-í•«í”½ìŠ¤-í”„ë¡œì„¸ìŠ¤)

---

## ì§ˆë¬¸ 1: ìš´ì˜ í™˜ê²½ ì§ì ‘ ìˆ˜ì • ë¬¸ì œ

### âŒ ë¬¸ì œ ì‹œë‚˜ë¦¬ì˜¤

```
1. ê°œë°œ PCì—ì„œ ì •ìƒ ë™ì‘
2. ìš´ì˜ ì„œë²„ì— ë°°í¬ í›„ ì—ëŸ¬ ë°œìƒ
3. ìš´ì˜ ì„œë²„ì—ì„œ ì§ì ‘ ì½”ë“œ ìˆ˜ì •í•˜ì—¬ í•´ê²°
4. ê°œë°œ PCì—ì„œ ì¶”ê°€ ê°œë°œ í›„ git push
5. ğŸš¨ ìš´ì˜ ì„œë²„ì— ìë™ ë°°í¬ â†’ ì§ì ‘ ìˆ˜ì •í•œ ë‚´ìš© ë®ì–´ì”€ â†’ ë‹¤ì‹œ ì—ëŸ¬ ë°œìƒ!
```

### ğŸ” ì›ì¸ ë¶„ì„

**ë¬¸ì œì˜ í•µì‹¬**
```
ìš´ì˜ ì„œë²„ ì§ì ‘ ìˆ˜ì • (Git ì´ë ¥ ì—†ìŒ)
    â†“
ê°œë°œ PCì—ì„œ git push
    â†“
GitHub Actionsê°€ ìµœì‹  main ë¸Œëœì¹˜ë¡œ ë°°í¬
    â†“
ìš´ì˜ ì„œë²„ì˜ ì§ì ‘ ìˆ˜ì • ë‚´ìš© ë®ì–´ì”€
    â†“
ë‹¤ì‹œ ì—ëŸ¬ ë°œìƒ ğŸ”¥
```

**Git ê´€ì ì—ì„œ ë³´ë©´**
```
GitHub main ë¸Œëœì¹˜ (ì§„ì‹¤ì˜ ì†ŒìŠ¤)
â”œâ”€ ì»¤ë°‹ A: ê°œë°œ PC ì‘ì—…
â”œâ”€ ì»¤ë°‹ B: ê°œë°œ PC ì‘ì—…
â””â”€ (ìš´ì˜ ì„œë²„ ì§ì ‘ ìˆ˜ì •ì€ Git ì´ë ¥ì— ì—†ìŒ!)

ìš´ì˜ ì„œë²„
â”œâ”€ ì»¤ë°‹ Bì˜ ì½”ë“œ (Gitì—ì„œ ë°›ìŒ)
â””â”€ + ì§ì ‘ ìˆ˜ì •í•œ ì½”ë“œ (Gitì— ì—†ìŒ)
```

### âœ… ì˜¬ë°”ë¥¸ í•´ê²° ë°©ë²•

#### ë°©ë²• 1: ìš´ì˜ ì„œë²„ ìˆ˜ì • ë‚´ìš©ì„ Gitìœ¼ë¡œ ê°€ì ¸ì˜¤ê¸° (ê¶Œì¥)

**Step 1: ìš´ì˜ ì„œë²„ì—ì„œ ë³€ê²½ ë‚´ìš© í™•ì¸**
```bash
# ìš´ì˜ ì„œë²„ (102 ë˜ëŠ” 101)
ssh hansol@192.168.219.102
cd /home/hansol/stock-trading-system

# Git ìƒíƒœ í™•ì¸
git status

# ë³€ê²½ëœ íŒŒì¼ í™•ì¸
git diff

# ë³€ê²½ ë‚´ìš© ë³µì‚¬ (íŒŒì¼ë³„ë¡œ)
git diff backend/main.py > /tmp/hotfix.patch
```

**Step 2: ë¡œì»¬ PCë¡œ íŒ¨ì¹˜ ê°€ì ¸ì˜¤ê¸°**
```bash
# ë¡œì»¬ PC
cd F:\hhstock

# íŒ¨ì¹˜ íŒŒì¼ ë‹¤ìš´ë¡œë“œ
scp hansol@192.168.219.102:/tmp/hotfix.patch .

# íŒ¨ì¹˜ ì ìš©
git apply hotfix.patch

# ë˜ëŠ” ìˆ˜ë™ìœ¼ë¡œ ì½”ë“œ ë³µì‚¬
```

**Step 3: ë¡œì»¬ì—ì„œ ì»¤ë°‹ ë° Push**
```bash
# ë¡œì»¬ PC
git add .
git commit -m "fix: ìš´ì˜ í™˜ê²½ í•«í”½ìŠ¤ ë°˜ì˜ - [ë¬¸ì œ ì„¤ëª…]"
git push origin main

# ì´ì œ ìë™ ë°°í¬ê°€ ì˜¬ë°”ë¥¸ ì½”ë“œë¥¼ ë°°í¬í•¨ âœ…
```

#### ë°©ë²• 2: ìš´ì˜ ì„œë²„ì—ì„œ ì§ì ‘ ì»¤ë°‹ & Push (ê¸´ê¸‰ ìƒí™©)

```bash
# ìš´ì˜ ì„œë²„
cd /home/hansol/stock-trading-system

# Git ì„¤ì • (ì²˜ìŒ í•œ ë²ˆë§Œ)
git config user.name "Production Server"
git config user.email "prod@stocktrading.com"

# ë³€ê²½ ë‚´ìš© ì»¤ë°‹
git add .
git commit -m "hotfix: ìš´ì˜ í™˜ê²½ ê¸´ê¸‰ ìˆ˜ì •"

# GitHubë¡œ Push
git push origin main
```

**ì£¼ì˜ì‚¬í•­**
- âš ï¸ ì´ ë°©ë²•ì€ **ê¸´ê¸‰ ìƒí™©**ì—ë§Œ ì‚¬ìš©
- âš ï¸ Push í›„ ë°˜ë“œì‹œ ë¡œì»¬ PCì—ì„œ `git pull` í•´ì•¼ í•¨
- âš ï¸ Git ì¸ì¦ ì„¤ì • í•„ìš” (SSH Key ë˜ëŠ” Personal Access Token)

#### ë°©ë²• 3: ìë™ ë°°í¬ ì¼ì‹œ ì¤‘ì§€ (ë¹„ì¶”ì²œ)

```bash
# .github/workflows/deploy.yml ìˆ˜ì •
on:
  push:
    branches:
      - main
  workflow_dispatch:  # ìˆ˜ë™ ë°°í¬ë§Œ í—ˆìš©

# ë˜ëŠ” íŠ¹ì • ê²½ë¡œë§Œ ë°°í¬ íŠ¸ë¦¬ê±°
on:
  push:
    branches:
      - main
    paths:
      - 'backend/**'
      - '!backend/temp-fix.py'  # íŠ¹ì • íŒŒì¼ ì œì™¸
```

**ë¬¸ì œì **
- âŒ CI/CD ìë™í™”ì˜ ì´ì  ìƒì‹¤
- âŒ ê°œë°œ/ìš´ì˜ í™˜ê²½ ë¶ˆì¼ì¹˜ ì§€ì†
- âŒ ê·¼ë³¸ì  í•´ê²°ì±…ì´ ì•„ë‹˜

### ğŸ¯ ê·¼ë³¸ ì›ì¸ í•´ê²°

#### ë¬¸ì œ: ì™œ ê°œë°œì—ì„œëŠ” ì •ìƒì¸ë° ìš´ì˜ì—ì„œ ì—ëŸ¬ê°€ ë°œìƒí•˜ë‚˜?

**ì¼ë°˜ì ì¸ ì›ì¸**

1. **í™˜ê²½ ë³€ìˆ˜ ì°¨ì´**
   ```python
   # ê°œë°œ: .env.development
   DB_HOST=localhost
   LOG_LEVEL=DEBUG

   # ìš´ì˜: .env.production
   DB_HOST=192.168.219.103
   LOG_LEVEL=INFO  # ì—ëŸ¬ ë¡œê·¸ê°€ ì•ˆ ë³´ì¼ ìˆ˜ ìˆìŒ!
   ```

2. **ë°ì´í„° ì°¨ì´**
   ```
   ê°œë°œ DB: í…ŒìŠ¤íŠ¸ ë°ì´í„° (ê¹¨ë—í•¨)
   ìš´ì˜ DB: ì‹¤ì œ ë°ì´í„° (íŠ¹ìˆ˜ ì¼€ì´ìŠ¤, NULL ê°’ ë“±)
   ```

3. **í¬íŠ¸/ë„ë©”ì¸ ì°¨ì´**
   ```
   ê°œë°œ: localhost:8000
   ìš´ì˜: 192.168.219.102:8000
   ```

4. **Docker ì´ë¯¸ì§€ ì°¨ì´**
   ```
   ê°œë°œ: ë¡œì»¬ ë¹Œë“œ (ìµœì‹  ì½”ë“œ)
   ìš´ì˜: CI/CD ë¹Œë“œ (ìºì‹œëœ ì´ë¯¸ì§€)
   ```

#### í•´ê²°ì±…: Staging í™˜ê²½ êµ¬ì¶•

```
ê°œë°œ PC (development)
    â†“ git push feature/xxx
Feature Branch
    â†“ Pull Request
Staging í™˜ê²½ (staging) â† ìš´ì˜ê³¼ ë™ì¼í•œ ì„¤ì •
    â†“ í…ŒìŠ¤íŠ¸ í†µê³¼ í›„ merge
ìš´ì˜ í™˜ê²½ (production)
```

**Staging í™˜ê²½ ì„¤ì •**

**.env.staging**
```env
ENVIRONMENT=staging
# ìš´ì˜ê³¼ ë™ì¼í•œ ì„¤ì • ì‚¬ìš©
DB_HOST=192.168.219.103
REDIS_HOST=192.168.219.103
# ë‹¨, ë³„ë„ í¬íŠ¸ ì‚¬ìš©
BACKEND_PORT=8001
```

**docker-compose.staging.yml**
```yaml
version: '3.8'

services:
  backend:
    ports:
      - "8001:8000"  # ìš´ì˜(8000)ê³¼ ë‹¤ë¥¸ í¬íŠ¸
    environment:
      - ENVIRONMENT=staging
```

---

## ì§ˆë¬¸ 2: ìš´ì˜ì—ì„œë§Œ ë°œìƒí•˜ëŠ” CORS ì—ëŸ¬

### ğŸš¨ ë¬¸ì œ ì‹œë‚˜ë¦¬ì˜¤

```
ê°œë°œ PC: ì •ìƒ ë™ì‘ âœ…
ìš´ì˜ ì„œë²„: CORS ì—ëŸ¬ ë°œìƒ âŒ

CORS policy: No 'Access-Control-Allow-Origin' header is present
```

### ğŸ” ì›ì¸ ë¶„ì„

**ì´ë¯¸ êµ¬í˜„ëœ CORS ì„¤ì • (config.py:110-126)**
```python
@property
def CORS_ORIGINS(self) -> list:
    """
    CORS í—ˆìš© Origin ëª©ë¡
    ê°œë°œ: ëª¨ë“  origin í—ˆìš©
    ìš´ì˜: íŠ¹ì • URLë§Œ í—ˆìš©
    """
    if self.ENVIRONMENT == "production":
        return [
            self.FRONTEND_URL,
            self.GRAFANA_URL,
            self.AIRFLOW_URL,
        ]
    else:
        # ê°œë°œ í™˜ê²½: ëª¨ë“  origin í—ˆìš©
        return ["*"]
```

**ë¬¸ì œ ë°œìƒ ì›ì¸**

1. **.env.productionì— URLì´ ì •í™•í•˜ì§€ ì•ŠìŒ**
   ```env
   # âŒ ì˜ëª»ëœ ì˜ˆ
   FRONTEND_URL=http://localhost:3000  # ìš´ì˜ì—ì„œ localhost?
   GRAFANA_URL=http://grafana:3000     # Docker ë‚´ë¶€ í˜¸ìŠ¤íŠ¸ëª…

   # âœ… ì˜¬ë°”ë¥¸ ì˜ˆ
   FRONTEND_URL=http://192.168.219.101:3000
   GRAFANA_URL=http://192.168.219.101:3000
   ```

2. **ì‹¤ì œ ìš”ì²­ Originê³¼ ì„¤ì •ëœ Originì´ ë‹¤ë¦„**
   ```
   ë¸Œë¼ìš°ì €ì—ì„œ ìš”ì²­: http://192.168.219.101:3000
   ì„¤ì •ëœ CORS:      http://192.168.219.101
   â†’ í¬íŠ¸ê°€ ë‹¬ë¼ì„œ ê±°ë¶€ë¨!
   ```

3. **í”„ë¡œí† ì½œ ì°¨ì´ (http vs https)**
   ```
   ë¸Œë¼ìš°ì € ìš”ì²­: https://domain.com
   ì„¤ì •ëœ CORS:  http://domain.com
   â†’ ë‹¤ë¥¸ Originìœ¼ë¡œ ê°„ì£¼ë¨!
   ```

### âœ… í•´ê²° ë°©ë²•

#### Step 1: ì‹¤ì œ ìš”ì²­ Origin í™•ì¸

**ë°©ë²• 1: ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬**
```
1. Chrome ê°œë°œì ë„êµ¬ (F12)
2. Network íƒ­
3. ì‹¤íŒ¨í•œ ìš”ì²­ ì„ íƒ
4. Headers íƒ­ì—ì„œ í™•ì¸:
   Request Headers
     Origin: http://192.168.219.101:3000
```

**ë°©ë²• 2: ì„œë²„ ë¡œê·¸ì—ì„œ í™•ì¸**
```bash
# Backend ë¡œê·¸ í™•ì¸
ssh hansol@192.168.219.102
docker-compose logs backend | grep -i "origin"

# ì¶œë ¥ ì˜ˆì‹œ
# Origin: http://192.168.219.101:3000
```

#### Step 2: .env.production ìˆ˜ì •

```bash
# ìš´ì˜ ì„œë²„ (102)
ssh hansol@192.168.219.102
cd /home/hansol/stock-trading-system
nano stock-trading-system/.env.production
```

**ìˆ˜ì • ë‚´ìš©**
```env
# ========================================
# ì˜¬ë°”ë¥¸ URL ì„¤ì •
# ========================================

# Frontend (Grafanaê°€ Frontend ì—­í• )
FRONTEND_URL=http://192.168.219.101:3000

# Grafana
GRAFANA_URL=http://192.168.219.101:3000

# Airflow
AIRFLOW_URL=http://192.168.219.101:8080

# Backend (ìê¸° ìì‹ )
BACKEND_URL=http://192.168.219.102:8000
```

#### Step 3: ì¶”ê°€ Origin í•„ìš” ì‹œ config.py ìˆ˜ì •

```python
# backend/config.py
@property
def CORS_ORIGINS(self) -> list:
    if self.ENVIRONMENT == "production":
        origins = [
            self.FRONTEND_URL,
            self.GRAFANA_URL,
            self.AIRFLOW_URL,
        ]

        # ì™¸ë¶€ ë„ë©”ì¸ ì¶”ê°€ (í™˜ê²½ ë³€ìˆ˜ë¡œ)
        if hasattr(self, 'EXTRA_CORS_ORIGINS') and self.EXTRA_CORS_ORIGINS:
            extra = self.EXTRA_CORS_ORIGINS.split(',')
            origins.extend(extra)

        return origins
    else:
        return ["*"]
```

**.env.productionì— ì¶”ê°€**
```env
# ì¶”ê°€ CORS Origin (ì‰¼í‘œë¡œ êµ¬ë¶„)
EXTRA_CORS_ORIGINS=http://192.168.219.101:8080,http://example.com
```

#### Step 4: ê°œë°œ PCì—ì„œ ìˆ˜ì • ë° ë°°í¬

```bash
# ë¡œì»¬ PC
cd F:\hhstock\stock-trading-system\backend

# config.py ìˆ˜ì • (ìœ„ì˜ ì½”ë“œ)
git add config.py
git commit -m "fix: CORS ì„¤ì • ê°œì„  - ì¶”ê°€ Origin ì§€ì›"
git push origin main

# ìë™ ë°°í¬ í›„ ì„œë²„ì—ì„œ .env.production ì—…ë°ì´íŠ¸
ssh hansol@192.168.219.102
cd /home/hansol/stock-trading-system
nano stock-trading-system/.env.production
# EXTRA_CORS_ORIGINS ì¶”ê°€

# ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘
docker-compose restart backend
```

### ğŸ§ª ê°œë°œ í™˜ê²½ì—ì„œ CORS ì—ëŸ¬ ì¬í˜„í•˜ê¸°

**ê°œë°œ í™˜ê²½ì—ì„œ ìš´ì˜ê³¼ ë™ì¼í•˜ê²Œ í…ŒìŠ¤íŠ¸**

**Step 1: .env.development ì„ì‹œ ìˆ˜ì •**
```env
# .env.development
ENVIRONMENT=production  # ì„ì‹œë¡œ ìš´ì˜ ëª¨ë“œ

FRONTEND_URL=http://localhost:3000
GRAFANA_URL=http://localhost:3000
AIRFLOW_URL=http://localhost:8080
```

**Step 2: Docker Compose ì¬ì‹œì‘**
```bash
cd F:\hhstock\stock-trading-system
docker-compose -f docker-compose.yml -f docker-compose.dev.yml restart backend
```

**Step 3: ë¸Œë¼ìš°ì €ì—ì„œ í…ŒìŠ¤íŠ¸**
```
1. http://localhost:3000 ì ‘ì†
2. Backend API í˜¸ì¶œ
3. CORS ì—ëŸ¬ ë°œìƒ ì—¬ë¶€ í™•ì¸
```

**Step 4: ì›ë³µ**
```env
# .env.development
ENVIRONMENT=development  # ë‹¤ì‹œ ê°œë°œ ëª¨ë“œ
```

### ğŸ”§ CORS ë””ë²„ê¹… íŒ

#### 1. CORS í—¤ë” í™•ì¸

**ì •ìƒ ì‘ë‹µ**
```
Response Headers:
  Access-Control-Allow-Origin: http://192.168.219.101:3000
  Access-Control-Allow-Methods: GET, POST, PUT, DELETE, OPTIONS
  Access-Control-Allow-Headers: Content-Type, Authorization
```

**ì—ëŸ¬ ì‘ë‹µ**
```
Response Headers:
  (Access-Control-Allow-Origin í—¤ë” ì—†ìŒ)
```

#### 2. Preflight ìš”ì²­ í™•ì¸

**OPTIONS ìš”ì²­ì´ ì‹¤íŒ¨í•˜ëŠ” ê²½ìš°**
```bash
# ì§ì ‘ í…ŒìŠ¤íŠ¸
curl -X OPTIONS http://192.168.219.102:8000/api/stocks \
  -H "Origin: http://192.168.219.101:3000" \
  -H "Access-Control-Request-Method: GET" \
  -v

# ì •ìƒ ì‘ë‹µ
< HTTP/1.1 200 OK
< Access-Control-Allow-Origin: http://192.168.219.101:3000
```

#### 3. FastAPI CORS ë¯¸ë“¤ì›¨ì–´ í™•ì¸

**backend/main.py í™•ì¸**
```python
from fastapi.middleware.cors import CORSMiddleware
from config import settings

app.add_middleware(
    CORSMiddleware,
    allow_origins=settings.CORS_ORIGINS,  # âœ… config.py ì‚¬ìš©
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

**ë””ë²„ê¹…ìš© ì„ì‹œ ìˆ˜ì •**
```python
# ì„ì‹œë¡œ ëª¨ë“  Origin í—ˆìš© (ìš´ì˜ì—ì„œ ì ˆëŒ€ ê¸ˆì§€!)
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],  # í…ŒìŠ¤íŠ¸ìš©
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# ì´ë ‡ê²Œ í•´ì„œ CORS ì—ëŸ¬ê°€ ì‚¬ë¼ì§€ë©´
# â†’ config.pyì˜ CORS_ORIGINS ì„¤ì • ë¬¸ì œ
```

---

## ì˜¬ë°”ë¥¸ ë°°í¬ ì›Œí¬í”Œë¡œìš°

### ğŸ¯ ê¶Œì¥ ì›Œí¬í”Œë¡œìš°

```
1. Feature Branch ìƒì„±
   â†“
2. ë¡œì»¬ ê°œë°œ ë° í…ŒìŠ¤íŠ¸
   â†“
3. ì»¤ë°‹ ë° Push
   â†“
4. Pull Request ìƒì„±
   â†“
5. ì½”ë“œ ë¦¬ë·°
   â†“
6. Staging í™˜ê²½ ë°°í¬ (ìˆ˜ë™ ë˜ëŠ” ìë™)
   â†“
7. Staging í…ŒìŠ¤íŠ¸
   â†“
8. Main ë¸Œëœì¹˜ ë³‘í•©
   â†“
9. ìš´ì˜ í™˜ê²½ ìë™ ë°°í¬
   â†“
10. ëª¨ë‹ˆí„°ë§ ë° ê²€ì¦
```

### ğŸ“ êµ¬ì²´ì ì¸ ì˜ˆì‹œ

#### ì‹œë‚˜ë¦¬ì˜¤: CORS ì—ëŸ¬ ìˆ˜ì •

**Step 1: Feature Branch ìƒì„±**
```bash
cd F:\hhstock
git checkout -b fix/cors-production-issue
```

**Step 2: ë¡œì»¬ì—ì„œ ì½”ë“œ ìˆ˜ì •**
```python
# backend/config.py ìˆ˜ì •
@property
def CORS_ORIGINS(self) -> list:
    if self.ENVIRONMENT == "production":
        origins = [
            self.FRONTEND_URL,
            self.GRAFANA_URL,
            self.AIRFLOW_URL,
            # ëˆ„ë½ëœ Origin ì¶”ê°€
            "http://192.168.219.101:8080",
        ]
        return origins
    else:
        return ["*"]
```

**Step 3: ë¡œì»¬ í…ŒìŠ¤íŠ¸**
```bash
# .env.developmentë¥¼ ì„ì‹œë¡œ production ëª¨ë“œë¡œ
ENVIRONMENT=production

# í…ŒìŠ¤íŠ¸
docker-compose up

# ì›ë³µ
ENVIRONMENT=development
```

**Step 4: ì»¤ë°‹ ë° Push**
```bash
git add backend/config.py
git commit -m "fix: CORS ìš´ì˜ í™˜ê²½ Origin ì¶”ê°€"
git push origin fix/cors-production-issue
```

**Step 5: Pull Request ìƒì„±**
```
GitHubì—ì„œ PR ìƒì„±
Title: fix: CORS ìš´ì˜ í™˜ê²½ Origin ì¶”ê°€
Description:
- ë¬¸ì œ: Airflow(8080 í¬íŠ¸)ì—ì„œ Backend API í˜¸ì¶œ ì‹œ CORS ì—ëŸ¬
- ì›ì¸: CORS_ORIGINSì— http://192.168.219.101:8080 ë¯¸ë“±ë¡
- í•´ê²°: config.pyì— Origin ì¶”ê°€
```

**Step 6: ë¦¬ë·° ë° ìŠ¹ì¸**
```
1. íŒ€ì› ë¦¬ë·°
2. ìŠ¹ì¸
3. Main ë¸Œëœì¹˜ ë³‘í•©
```

**Step 7: ìë™ ë°°í¬**
```
GitHub Actions ìë™ ì‹¤í–‰
â†’ 102 ì„œë²„ ë°°í¬
â†’ Health Check
â†’ ì™„ë£Œ âœ…
```

**Step 8: ê²€ì¦**
```bash
# Airflowì—ì„œ Backend API í˜¸ì¶œ í…ŒìŠ¤íŠ¸
curl http://192.168.219.102:8000/api/stocks \
  -H "Origin: http://192.168.219.101:8080"

# CORS í—¤ë” í™•ì¸
# Access-Control-Allow-Origin: http://192.168.219.101:8080
```

---

## í™˜ê²½ë³„ ë””ë²„ê¹… ì „ëµ

### ğŸ” ê°œë°œ í™˜ê²½ì—ì„œ ìš´ì˜ ì´ìŠˆ ì¬í˜„

#### 1. Docker Compose Override í™œìš©

**docker-compose.debug.yml ìƒì„±**
```yaml
version: '3.8'

services:
  backend:
    environment:
      # ìš´ì˜ê³¼ ë™ì¼í•œ í™˜ê²½ ë³€ìˆ˜
      - ENVIRONMENT=production
      - DB_HOST=192.168.219.103
      - REDIS_HOST=192.168.219.103
    # í•˜ì§€ë§Œ ë¡œì»¬ ë³¼ë¥¨ ë§ˆìš´íŠ¸ (í•« ë¦¬ë¡œë“œ)
    volumes:
      - ./backend:/app
    # ë””ë²„ê·¸ ëª¨ë“œ
    command: uvicorn main:app --host 0.0.0.0 --port 8000 --reload --log-level debug
```

**ì‚¬ìš©ë²•**
```bash
# ìš´ì˜ ì„¤ì • + ê°œë°œ í¸ì˜ì„±
docker-compose -f docker-compose.yml -f docker-compose.debug.yml up
```

#### 2. ìš´ì˜ ë°ì´í„° ë³µì œ

```bash
# 103 ì„œë²„ì—ì„œ ë°ì´í„° ë°±ì—…
ssh hansol@192.168.219.103
docker exec stock-db pg_dump -U admin stocktrading > /tmp/prod_backup.sql

# ë¡œì»¬ë¡œ ë‹¤ìš´ë¡œë“œ
scp hansol@192.168.219.103:/tmp/prod_backup.sql F:/hhstock/

# ë¡œì»¬ DBì— ë³µì›
docker exec -i stock-db psql -U admin stocktrading < F:/hhstock/prod_backup.sql
```

**ì£¼ì˜: ë¯¼ê° ë°ì´í„°ëŠ” ë§ˆìŠ¤í‚¹**
```sql
-- ì‚¬ìš©ì ì •ë³´ ë§ˆìŠ¤í‚¹
UPDATE users SET
  email = CONCAT('user', id, '@example.com'),
  password = 'masked';
```

#### 3. ë¡œê·¸ ë ˆë²¨ ì¼ì¹˜

**ê°œë°œ í™˜ê²½**
```env
LOG_LEVEL=DEBUG  # ëª¨ë“  ë¡œê·¸ ì¶œë ¥
```

**ìš´ì˜ í™˜ê²½ (ì„ì‹œë¡œ DEBUGë¡œ ë³€ê²½)**
```bash
# .env.production
LOG_LEVEL=DEBUG  # ì„ì‹œ

# ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘
docker-compose restart backend

# ë¡œê·¸ í™•ì¸
docker-compose logs -f backend

# ë””ë²„ê¹… ì™„ë£Œ í›„ ì›ë³µ
LOG_LEVEL=INFO
```

### ğŸ§ª Staging í™˜ê²½ êµ¬ì¶•

#### Staging ì„œë²„ ì„¤ì • (ê¶Œì¥)

**ì˜µì…˜ 1: ë³„ë„ ì„œë²„**
```
104 ì„œë²„ (Staging)
- ìš´ì˜ê³¼ ë™ì¼í•œ ì„¤ì •
- ìš´ì˜ ë°ì´í„° ë³µì œ (ë§ˆìŠ¤í‚¹)
- Feature Branch ìë™ ë°°í¬
```

**ì˜µì…˜ 2: ê¸°ì¡´ ì„œë²„ì— ë‹¤ë¥¸ í¬íŠ¸**
```
102 ì„œë²„
- 8000: ìš´ì˜ (production)
- 8001: ìŠ¤í…Œì´ì§• (staging)
```

**GitHub Actions Workflow**
```yaml
# .github/workflows/deploy-staging.yml
name: Deploy to Staging

on:
  push:
    branches:
      - develop  # develop ë¸Œëœì¹˜ëŠ” stagingìœ¼ë¡œ

jobs:
  deploy-staging:
    runs-on: ubuntu-latest
    steps:
      - name: Deploy to Staging Server
        run: |
          ssh hansol@192.168.219.102 << 'EOF'
            cd /home/hansol/stock-trading-system-staging
            git pull origin develop
            ENVIRONMENT=staging docker-compose -f docker-compose.yml -f docker-compose.staging.yml up -d
          EOF
```

---

## ê¸´ê¸‰ í•«í”½ìŠ¤ í”„ë¡œì„¸ìŠ¤

### ğŸš¨ ìš´ì˜ í™˜ê²½ ê¸´ê¸‰ ìƒí™©

**ì‹œë‚˜ë¦¬ì˜¤**: ìš´ì˜ ì„œë²„ì—ì„œ ì‹¬ê°í•œ ë²„ê·¸ ë°œê²¬, ì¦‰ì‹œ ìˆ˜ì • í•„ìš”

#### ë°©ë²• 1: Hotfix Branch (ê¶Œì¥)

```bash
# 1. ë¡œì»¬ì—ì„œ hotfix ë¸Œëœì¹˜ ìƒì„±
git checkout main
git pull
git checkout -b hotfix/critical-bug

# 2. ê¸´ê¸‰ ìˆ˜ì •
# (ì½”ë“œ ìˆ˜ì •)

# 3. ë¡œì»¬ í…ŒìŠ¤íŠ¸ (ë¹ ë¥´ê²Œ)
docker-compose up

# 4. ì»¤ë°‹ ë° Push
git add .
git commit -m "hotfix: ê¸´ê¸‰ ìˆ˜ì • - [ë¬¸ì œ ì„¤ëª…]"
git push origin hotfix/critical-bug

# 5. GitHubì—ì„œ PR ìƒì„± (mainìœ¼ë¡œ)
# Title: [HOTFIX] ê¸´ê¸‰ ìˆ˜ì • - [ë¬¸ì œ]

# 6. ë¹ ë¥¸ ë¦¬ë·° (ë˜ëŠ” Skip)
# 7. Main ë³‘í•© â†’ ìë™ ë°°í¬

# 8. Hotfixë¥¼ developì—ë„ ë³‘í•© (ë™ê¸°í™”)
git checkout develop
git merge hotfix/critical-bug
git push origin develop
```

**íƒ€ì„ë¼ì¸**
```
ë°œê²¬: T+0ë¶„
ìˆ˜ì •: T+5ë¶„
ë°°í¬: T+10ë¶„
ê²€ì¦: T+15ë¶„
```

#### ë°©ë²• 2: ìš´ì˜ ì„œë²„ ì§ì ‘ ìˆ˜ì • (ìµœí›„ì˜ ìˆ˜ë‹¨)

```bash
# 1. ìš´ì˜ ì„œë²„ ì ‘ì†
ssh hansol@192.168.219.102

# 2. ìë™ ë°°í¬ ì„ì‹œ ì¤‘ì§€
# GitHub Actions â†’ Disable workflow

# 3. ê¸´ê¸‰ ìˆ˜ì •
cd /home/hansol/stock-trading-system/backend
nano main.py  # ìˆ˜ì •

# 4. Docker ì¬ì‹œì‘
cd /home/hansol/stock-trading-system
docker-compose restart backend

# 5. ê²€ì¦
curl http://localhost:8000/health

# 6. ìˆ˜ì • ë‚´ìš© Gitì— ë°˜ì˜
git diff > /tmp/hotfix.patch
scp /tmp/hotfix.patch user@local-pc:/path/

# 7. ë¡œì»¬ PCì—ì„œ ì •ì‹ ì»¤ë°‹
# (ë°©ë²• 1 ì°¸ê³ )

# 8. ìë™ ë°°í¬ ì¬í™œì„±í™”
# GitHub Actions â†’ Enable workflow
```

**ì£¼ì˜ì‚¬í•­**
- âš ï¸ ì´ ë°©ë²•ì€ ì •ë§ ê¸´ê¸‰í•œ ê²½ìš°ë§Œ ì‚¬ìš©
- âš ï¸ ë°˜ë“œì‹œ ì‚¬í›„ì— Gitì— ë°˜ì˜
- âš ï¸ íŒ€ì›ì—ê²Œ ì¦‰ì‹œ ì•Œë¦¼

### ğŸ“± ì•Œë¦¼ ì„¤ì •

**Slack ì•Œë¦¼ ì˜ˆì‹œ**
```yaml
# .github/workflows/deploy.ymlì— ì¶”ê°€
- name: Notify on Deployment
  uses: slackapi/slack-github-action@v1
  with:
    payload: |
      {
        "text": "ğŸš€ Deployment to Production",
        "blocks": [
          {
            "type": "section",
            "text": {
              "type": "mrkdwn",
              "text": "*Status:* ${{ job.status }}\n*Commit:* ${{ github.sha }}\n*Author:* ${{ github.actor }}"
            }
          }
        ]
      }
```

---

## ìš”ì•½ ë° ì²´í¬ë¦¬ìŠ¤íŠ¸

### âœ… ì§ˆë¬¸ 1: ìš´ì˜ ì§ì ‘ ìˆ˜ì • ë¬¸ì œ

**í•´ê²° ë°©ë²•**
1. âœ… ìš´ì˜ ìˆ˜ì • ë‚´ìš©ì„ Gitìœ¼ë¡œ ê°€ì ¸ì™€ì„œ ì»¤ë°‹
2. âœ… ë˜ëŠ” ìš´ì˜ ì„œë²„ì—ì„œ ì§ì ‘ ì»¤ë°‹ & Push (ê¸´ê¸‰)
3. âŒ ìë™ ë°°í¬ ì¤‘ì§€ (ë¹„ì¶”ì²œ)

**ê·¼ë³¸ í•´ê²°**
- Staging í™˜ê²½ êµ¬ì¶•
- ë¡œì»¬ì—ì„œ ìš´ì˜ í™˜ê²½ ì¬í˜„
- Feature Branch ì›Œí¬í”Œë¡œìš°

### âœ… ì§ˆë¬¸ 2: CORS ì—ëŸ¬

**í•´ê²° ë°©ë²•**
1. âœ… ë¸Œë¼ìš°ì €/ë¡œê·¸ì—ì„œ ì‹¤ì œ Origin í™•ì¸
2. âœ… .env.production ìˆ˜ì • (FRONTEND_URL ë“±)
3. âœ… config.pyì˜ CORS_ORIGINS í™•ì¸
4. âœ… ë¡œì»¬ì—ì„œ ì¬í˜„ (ENVIRONMENT=production)

**ì˜ˆë°© ë°©ë²•**
- CORS_ORIGINSë¥¼ í™˜ê²½ ë³€ìˆ˜ë¡œ ì™¸ë¶€í™”
- Staging í™˜ê²½ì—ì„œ í…ŒìŠ¤íŠ¸
- CORS í—¤ë” ìë™ í…ŒìŠ¤íŠ¸

### ğŸ“‹ ë°°í¬ ì „ ì²´í¬ë¦¬ìŠ¤íŠ¸

```markdown
- [ ] ë¡œì»¬ì—ì„œ í…ŒìŠ¤íŠ¸ ì™„ë£Œ
- [ ] í™˜ê²½ ë³€ìˆ˜ ì°¨ì´ í™•ì¸ (.env.development vs .env.production)
- [ ] CORS Origin ì„¤ì • í™•ì¸
- [ ] ìš´ì˜ ë°ì´í„°ë¡œ í…ŒìŠ¤íŠ¸ (ê°€ëŠ¥í•˜ë©´)
- [ ] Staging í™˜ê²½ í…ŒìŠ¤íŠ¸ (ìˆë‹¤ë©´)
- [ ] ë¡¤ë°± ê³„íš ìˆ˜ë¦½
- [ ] ëª¨ë‹ˆí„°ë§ ì¤€ë¹„
```

---

## ê´€ë ¨ ë¬¸ì„œ

- [Gitìë™ë°°í¬ì•„í‚¤í…ì²˜-ê°€ì´ë“œ-20251009.md](./Gitìë™ë°°í¬ì•„í‚¤í…ì²˜-ê°€ì´ë“œ-20251009.md)
- [CICDí™˜ê²½ë¶„ë¦¬ì „ëµ-ê°€ì´ë“œ-20251009.md](../deployment/CICDí™˜ê²½ë¶„ë¦¬ì „ëµ-ê°€ì´ë“œ-20251009.md)
- [CICDíŒŒì´í”„ë¼ì¸êµ¬ì¶•-ê°œë°œ-20251009.md](../deployment/CICDíŒŒì´í”„ë¼ì¸êµ¬ì¶•-ê°œë°œ-20251009.md)

---

**ì‘ì„±ì¼**: 2025-10-09
**ìµœì¢… ì—…ë°ì´íŠ¸**: 2025-10-09
**ë¬¸ì„œ ë²„ì „**: 1.0
